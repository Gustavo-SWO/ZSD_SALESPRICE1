/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(B,F,a){"use strict";return B.extend("zzcus.sd.salesprices.manage..util.DynamicalAreaUtil",{aDefaultFilters:["EditingStatus","FilterMethod","ConditionType","ConditionTable","ConditionRecord","ValidOnDate"],aDefaultColumns:["ConditionType","ConditionTable","ConditionValidityStartDate","ConditionValidityEndDate","ConditionRateValue","ConditionQuantity","ConditionLowerLimit","ConditionUpperLimit","ConditionText","PaymentTerms","FixedValueDate","AdditionalValueDays","ConditionToBaseQtyNmrtr","ConditionToBaseQtyDnmntr","BaseUnit","ConditionCalculationType","ConditionRecord","SalesPriceApprovalRequest","ConditionProcessingStatus","ConditionReleaseStatus","Status"],aOptionalFilter:["ConditionValidityStartDate","ConditionValidityEndDate"],aOtherSelectedFilter:[],aKeyFields:[],iKeyFieldsNumber:0,aFilters:[],aColumns:[],aKeyFieldsFilters:[],oDataModel:undefined,sEntitySet:undefined,aKeyFieldsResult:[],aFilterFields:[],aKeyFieldsResultOld:[],constructor:function(s,S,b){this.oSmartFilterBar=s;this.oNoteListManager=S;this.oBusyModel=b;this.aFilters=s.getAllFilterItems();this.aColumns=S.getTable().getColumns();},getKeyField:function(){return this.aFilterFields;},setDataSource:function(d,e){this.oDataModel=d;this.sEntitySet=e;},setFilterValues:function(f){this.aKeyFieldsFilters=[];for(var x in f){if(f[x]){var b=[];if(f[x].values instanceof Array){for(var y=0;y<f[x].values.length;y++){b.push(new F(f[x].name,a.EQ,f[x].values[y].key));}}else{b.push(new F(f[x].name,a.EQ,f[x].values));}this.aKeyFieldsFilters.push(new F({filters:b,and:false}));}}},changeDynamicalArea:function(i,b,c){if(this.aKeyFieldsFilters.length!==0){this.oDataModel.read(this.sEntitySet,{filters:this.aKeyFieldsFilters,success:function(d){this.aKeyFieldsResult=d.results;this.aKeyFields=[];this.aOtherSelectedFilter=[];for(var x in d.results){if(d.results[x]&&this.aKeyFields.indexOf(d.results[x].ConditionFieldName)===-1){this.aKeyFields.push(d.results[x].ConditionFieldName);}}if(c){this.aKeyFieldsResultOld=this.aKeyFieldsResult.concat();this.aFilterFields=this.aKeyFields.concat();this.iKeyFieldsNumber=this.aKeyFields.length;if(this.oBusyModel.getProperty("/isBusy")){this.oBusyModel.setProperty("/isBusy",false);}return;}this._resetFilterBar(b,i);this._hideColumn();if(i!==undefined){this.oSmartFilterBar.search();}if(b){this.oNoteListManager.rebindTable(true);}if(this.oBusyModel.getProperty("/isBusy")){this.oBusyModel.setProperty("/isBusy",false);}}.bind(this)});}else{this._initFilterBar(c,i);}},_resetFilterBar:function(b,I){if(b===undefined){this._resetFilterData(I);this.aKeyFieldsResultOld=this.aKeyFieldsResult.concat();this.aFilterFields=this.aKeyFields.concat();for(var i in this.aFilters){if(this.aDefaultFilters.indexOf(this.aFilters[i].getName())!==-1||this.aKeyFields.indexOf(this.aFilters[i].getName())!==-1||this.aOtherSelectedFilter.indexOf(this.aFilters[i].getName())!==-1){this.aFilters[i].setVisibleInAdvancedArea(true);continue;}else{this.aFilters[i].setVisibleInAdvancedArea(false);}}}else{for(i in this.aFilterFields){if(this.aKeyFields.indexOf(this.aFilterFields[i])===-1){this.aKeyFields.push(this.aFilterFields[i]);}}this.aKeyFieldsResult=this.aKeyFieldsResultOld.concat();}this.iKeyFieldsNumber=this.aKeyFields.length;},_resetFilterData:function(i){var f=Object.assign({},this.oSmartFilterBar.getFilterData());if(f!==undefined){var o={};if(f.ConditionRecord!==undefined){o.ConditionRecord=f.ConditionRecord;}if(f.ValidOnDate!==undefined){o.ValidOnDate=f.ValidOnDate;}if(f.ConditionType!==undefined){o.ConditionType=f.ConditionType;}if(f.ConditionTable!==undefined){o.ConditionTable=f.ConditionTable;}for(var x in this.aKeyFields){if(f[this.aKeyFields[x]]!==undefined){o[this.aKeyFields[x]]=f[this.aKeyFields[x]];}}for(x in this.aOptionalFilter){if(f[this.aOptionalFilter[x]]!==undefined){o[this.aOptionalFilter[x]]=f[this.aOptionalFilter[x]];this.aOtherSelectedFilter.push(this.aOptionalFilter[x]);}}if(i===undefined){this.oSmartFilterBar._resetFilterFields();this.oSmartFilterBar.setFilterData(o);}}},_hideColumn:function(){var f=[];var s="";var b=false;for(var m=0;m<this.aColumns.length;m++){f=this.aColumns[m].getId().split("-");s=f[f.length-1];for(var k in this.aDefaultColumns){if((s===this.aDefaultColumns[k])){this.aColumns[m].setVisible(true);b=true;break;}else{b=false;}}if(b){continue;}this.aColumns[m].setVisible(false);for(var n in this.aKeyFields){if(s===this.aKeyFields[n]){this.aColumns[m].setVisible(true);b=true;}}}},_initFilterBar:function(i,I){this.aFilterFields=[];this.aKeyFieldsResult=[];this.iKeyFieldsNumber=0;if(i){if(this.oBusyModel.getProperty("/isBusy")){this.oBusyModel.setProperty("/isBusy",false);}return;}for(var e in this.aFilters){if(this.aFilters[e]&&(this.aDefaultFilters.indexOf(this.aFilters[e].getName())!==-1)){this.aFilters[e].setVisibleInAdvancedArea(true);continue;}else{this.aFilters[e].setVisibleInAdvancedArea(false);}}for(var f in this.aColumns){if(this.aColumns[f]){this.aColumns[f].setVisible(true);}}if(I!==undefined){if(this.oBusyModel.getProperty("/isBusy")){this.oBusyModel.setProperty("/isBusy",false);}this.oSmartFilterBar.search();return;}var o=Object.assign({},this.oSmartFilterBar.getFilterData());if(o!==undefined){var b={};if(o.ConditionRecord!==undefined){b.ConditionRecord=o.ConditionRecord;}if(o.ValidOnDate!==undefined){b.ValidOnDate=o.ValidOnDate;}this.oSmartFilterBar._resetFilterFields();this.oSmartFilterBar.setFilterData(b);}if(this.oBusyModel.getProperty("/isBusy")){this.oBusyModel.setProperty("/isBusy",false);}}});});
