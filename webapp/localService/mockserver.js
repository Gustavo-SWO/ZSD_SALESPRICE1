/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/util/MockServer","sap/ui/model/json/JSONModel","sap/base/util/UriParameters","sap/base/Log"],function(q,M,J,U,L){"use strict";var m,_="cus/sd/salesprices/manage/",b=_+"localService/mockdata";var o={init:function(O){var c=O||{};return new Promise(function(r,R){var s=sap.ui.require.toUrl(_+"manifest.json"),d=new J(s);d.attachRequestCompleted(function(){var u=new U(window.location.href),j=sap.ui.require.toUrl(b),D=d.getProperty("/sap.app/dataSources"),e=d.getProperty("/sap.app/dataSources/mainService"),A=e.settings.annotations,f=sap.ui.require.toUrl(_+e.settings.localUri),g=/.*\/$/.test(e.uri)?e.uri:e.uri+"/",C=20;if(!m){m=new M({rootUri:g});}else{m.stop();}M.config({autoRespond:true,autoRespondAfter:(c.delay||u.get("serverDelay")||500)});m.simulate(f,{sMockdataBaseUrl:j,bGenerateMissingMockData:true});var h=m.getRequests();var k=function(i,a,v){v.response=function(x){x.respond(i,{"Content-Type":"text/plain;charset=utf-8"},a);};};if(c.metadataError||u.get("metadataError")){h.forEach(function(a){if(a.path.toString().indexOf("$metadata")>-1){k(500,"metadata Error",a);}});}var E=c.errorType||u.get("errorType"),l=E==="badRequest"?400:500;if(E){h.forEach(function(a){k(l,E,a);});}h.push({method:"POST",path:new RegExp("C_SlsPricingConditionRecordTPActivation(.*)"),response:function(x,a){var i=a.search("guid")+4;var v=a.substr(i,38);var I=a.search("IsActiveEntity=")+15;var w=a.substr(I,5);var F=[];F.push("ConditionRecordUUID eq "+v);F.push("IsActiveEntity eq "+w);var y=q.sap.sjax({url:"/sap/opu/odata/sap/SD_PRICING_CONDITIONRECORD_SRV/C_SlsPricingConditionRecordTP?$filter="+F.join(" and "),dataType:"json"});if(!y.success||!y.data.d.results[0]){x.respond(404);return false;}var z=y.data.d.results[0];if(z.IsActiveEntity){x.respond(400);return false;}if(z.HasActiveEntity){var S=z.SiblingEntity.__deferred.uri;y=q.sap.sjax({url:S,dataType:"json"});if(y.success&&y.data&&y.data.d.__metadata){var B=y.data.d;y=q.sap.sjax({url:B.__metadata.uri,type:"DELETE"});}}if(z.ConditionTable===""){x.respondJSON(400,{},JSON.stringify({error:{"code":"PRCG_CNDNRECORD_API/020","message":{"lang":"en","value":"Condition record $10502218: Property \"Condition Table\" is required."},"innererror":{"errordetails":[{"code":"PRCG_CNDNRECORD_API/020","message":"Condition record $10502218: Property \"Condition Table\" is required.","propertyref":"","severity":"error","transition":true,"target":""}]}}}));return false;}z.IsActiveEntity=true;z.HasActiveEntity=false;z.HasDraftEntity=false;z.ConditionQuantity_fc=1;z.ConditionQuantityUnit_fc=1;z.ConditionRateValue_fc=1;z.ConditionRateValueUnit_fc=1;z.ConditionRecord=z.ConditionRecordUUID.substr(0,8)+z.ConditionRecordUUID.substr(9,2);z.ConditionRecordIsDraft=false;z.Status="U";y=q.sap.sjax({url:z.__metadata.uri,type:"PATCH",data:JSON.stringify(z)});if(!y.success){x.respond(404);return false;}x.respondJSON(200,{"sap-message":'{"code":"PRCG_CNDNRECORD_API/016","message":"Validity period of condition record 0000193713 is changed and is from 27.06.2017 to 27.06.2019.","severity":"info","target":"","transition":true,"details":[{"code":"PRCG_CNDNRECORD_API/015","message":"Condition record bdcf2d0f04 (temp. No. $00000021) is created and valid from 28.06.2019 to 31.12.9999.","target":"","severity":"info","transition":true},{"code":"PRCG_CNDNRECORD_API/014","message":"Condition record bdcf2d0f04 overlaps with condition record 0000193713.","target":"","severity":"info","transition":true},{"code":"00/000","message":"SimulateWF:00006046580100000000000000000000/506B4BC345CC1EEB96DF58C9655878E5","target":"","severity":"info","transition":true}]}'},JSON.stringify({d:z}));L.debug("MockServer: response sent with: "+200);return true;}});h.push({method:"POST",path:new RegExp("C_SlsPricingConditionRecordTPSimulate(.*)"),response:function(x,a){var i={"d":{"C_SlsPricingConditionRecordTPSimulate":{"__metadata":{"type":"SD_PRICING_CONDITIONRECORD_SRV.DummyFunctionImportResult"},"IsInvalid":false}}};var v="{\"code\":\"00/001\",\"message\":\"00006046590120011231/506B4BC345CC1EEB96DF58C9655878E5\",\"target\":\"(ConditionRecordUUID=guid'00006046-5901-2001-1231-000000000000',IsActiveEntity=false)\",\"severity\":\"info\",\"transition\":true,\"details\":[{\"code\":\"00/001\",\"message\":\"00006046690120021231/506B4BC345CC1EEB96DF58C9655878E5\",\"target\":\"(ConditionRecordUUID=guid'00006046-6901-2002-1231-000000000000',IsActiveEntity=false)\",\"severity\":\"info\",\"transition\":true}]}";x.respondJSON(200,{"sap-message":v},JSON.stringify({d:i}));L.debug("MockServer: response sent with: "+200);return true;}});h.push({method:"POST",path:new RegExp("AE3B72B4F1AA3073D427A3Requestforapproval(.*)"),response:function(x,a){var i={"d":{"AE3B72B4F1AA3073D427A3Requestforapproval":{"__metadata":{"type":"SD_PRICING_CONDITIONRECORD_SRV.DummyFunctionImportResult"},"IsInvalid":false}}};var v="{\"code\":\"00/001\",\"message\":\"0000604669\",\"severity\":\"info\",\"transition\":true,\"details\":[]}";x.respondJSON(200,{"sap-message":v},JSON.stringify({d:i}));L.debug("MockServer: response sent with: "+200);return true;}});h.push({method:"POST",path:new RegExp("AE3B72B4F1AA3073D42Deleteconditionrecord(.*)"),response:function(X,a){var T=a.search("Totalcount=")+11;var i=parseInt(a.substr(T),10);var v=a.search("ConditionRecordUUID=")+21;var I=a.search("IsActiveEntity=")+15;var w=a.substr(I,4);for(var x=0;x<i;x++){var y=a.substr(v,36);y="'"+y+"'";var F=[];F.push("ConditionRecordUUID eq "+y);F.push("IsActiveEntity eq "+w);var z=q.sap.sjax({url:"/sap/opu/odata/sap/SD_PRICING_CONDITIONRECORD_SRV/C_SlsPricingConditionRecordTP(ConditionRecordUUID=guid"+y+",IsActiveEntity="+w+")",type:"DELETE"});if(!z.success){X.respond(400);return false;}var B={"d":{"AE3B72B4F1AA3073D42Deleteconditionrecord":{"__metadata":{"type":"SD_PRICING_CONDITIONRECORD_SRV.DummyFunctionImportResult"},"IsInvalid":false}}};v+=39;}X.respondJSON(200,{},JSON.stringify({d:B}));L.debug("MockServer: response sent with: "+200);return true;}});h.push({method:"POST",path:new RegExp("AE3B72B4F1AA3073D427AEditconditionrecord(.*)"),response:function(X,a){var T=a.search("Totalcount=")+11;var i=parseInt(a.substr(T),10);var v=a.search("ConditionRecordUUID=")+21;var I=a.search("IsActiveEntity=")+15;var w=a.substr(I,4);for(var x=0;x<i;x++){var y=a.substr(v,36);y="'"+y+"'";var F=[];F.push("ConditionRecordUUID eq "+y);F.push("IsActiveEntity eq "+w);var z=q.sap.sjax({url:"/sap/opu/odata/sap/SD_PRICING_CONDITIONRECORD_SRV/C_SlsPricingConditionRecordTP?$filter="+F.join(" and "),dataType:"json"});if(!z.success||!z.data.d.results[0]){X.respond(404);return false;}var B=z.data.d.results[0];if(!B.IsActiveEntity){X.respond(400);return false;}B.IsActiveEntity=false;B.ConditionQuantity_fc=3;B.ConditionQuantityUnit_fc=3;B.ConditionRateValue_fc=3;B.ConditionRateValueUnit_fc=3;B.ConditionRecordIsDraft=true;B.Status="D";var H=B.__metadata.uri;B.__metadata.id=B.__metadata.id.replace("true","false");B.__metadata.uri=B.__metadata.uri.replace("true","false");z=q.sap.sjax({url:H,type:"PATCH",data:JSON.stringify(B)});if(!z.success){X.respond(404);return false;}v+=39;}B={"d":{"AE3B72B4F1AA3073D427AEditconditionrecord":{"__metadata":{"type":"SD_PRICING_CONDITIONRECORD_SRV.DummyFunctionImportResult"},"IsInvalid":false}}};X.respondJSON(200,{},JSON.stringify({d:B}));L.debug("MockServer: response sent with: "+200);return true;}});m.setRequests(h);var n=function(v,a){var w=a.toString().length;var x=new Array();for(var i=0;i<v-w;i++){x[i]=0;}var y="$"+x.join("");return y;};var p=function(a){C+=1;a.getParameter("oEntity").ConditionRecord=n(8,C)+C;a.getParameter("oEntity").ConditionRecordIsDraft=true;a.getParameter("oEntity").Status="D";var i=new Date();var v=i.toLocaleDateString()+" 08:00:00";a.getParameter("oEntity").DraftEntityCreationDateTime="/Date("+ +new Date()+")/";a.getParameter("oEntity").DraftEntityLastChangeDateTime="/Date("+ +new Date()+")/";a.getParameter("oEntity").CreationDate="/Date("+ +new Date(v)+")/";if(a.getParameter("oEntity").SiblingEntity.__deferred.uri.search("true")!==-1){a.getParameter("oEntity").SiblingEntity.__deferred.uri=a.getParameter("oEntity").SiblingEntity.__deferred.uri.replace("true","false");}if(a.getParameter("oEntity").__metadata.id.search("true")!==-1){a.getParameter("oEntity").__metadata.id=a.getParameter("oEntity").__metadata.id.replace("true","false");}if(a.getParameter("oEntity").__metadata.uri.search("true")!==-1){a.getParameter("oEntity").__metadata.uri=a.getParameter("oEntity").__metadata.uri.replace("true","false");}var w={AccessNumberOfAccessSequence:"000",AccountTaxType:"",AccountTaxType_fc:3,Activation_ac:true,ActiveUUID:"00000000-0000-0000-0000-000000000000",AdditionalMaterialGroup1:"",AdditionalMaterialGroup1_fc:3,AdditionalMaterialGroup2:"",AdditionalMaterialGroup2_fc:3,AdditionalMaterialGroup3:"",AdditionalMaterialGroup3_fc:3,AdditionalMaterialGroup4:"",AdditionalMaterialGroup4_fc:3,AdditionalMaterialGroup5:"",AdditionalMaterialGroup5_fc:3,AdditionalValueDays:"00",BRSpcfcFreeDefinedField1:"",BRSpcfcFreeDefinedField1_fc:3,BRSpcfcFreeDefinedField2:"",BRSpcfcFreeDefinedField2_fc:3,BRSpcfcFreeDefinedField3:"",BRSpcfcFreeDefinedField3_fc:3,BRSpcfcTaxBasePercentageCode:"0",BRSpcfcTaxBasePercentageCode_fc:3,BRSpcfcTaxDepartureRegion:"",BRSpcfcTaxDepartureRegion_fc:3,BRSpcfcTaxDestinationRegion:"",BRSpcfcTaxDestinationRegion_fc:3,BRSpcfcTxGrpDynTaxExceptions:"00",BRSpcfcTxGrpDynTaxExceptions_fc:3,BR_NFDocumentType:"",BR_NFDocumentType_fc:3,BR_TaxCode:"",BR_TaxCode_fc:3,BaseUnit:"",BillableControl:"",BillableControl_fc:3,CityCode:"",CityCode_fc:3,CndnMaxNumberOfSalesOrders:"00",CommodityCode:"",CommodityCode_fc:3,ConditionAlternativeCurrency:"",ConditionApplication:"V",ConditionCalculationType:"",ConditionCalculationType_fc:3,ConditionContract:"",ConditionContract_fc:3,ConditionExclusion:"",ConditionIsDeleted:false,ConditionIsExclusive:false,ConditionIsExclusive_fc:3,ConditionLowerLimit:"0.000",ConditionProcessingStatus:"",ConditionProcessingStatus_fc:3,ConditionQuantity:"0",ConditionQuantityUnit:"",ConditionQuantityUnit_fc:3,ConditionQuantity_fc:3,ConditionRateValue:"0.00",ConditionRateValueUnit:"",ConditionRateValueUnit_fc:3,ConditionRateValue_fc:3,ConditionRecordIsEditable:false,ConditionReleaseStatus:"",ConditionReleaseStatus_fc:1,ConditionScaleAmount:"0.000",ConditionScaleAmountCurrency:"",ConditionScaleBasisValue:"0000000",ConditionScaleBasisValue_fc:3,ConditionScaleQuantity:"0.000",ConditionScaleQuantityUnit:"",ConditionTable:"",ConditionTable_fc:3,ConditionTextID:"",ConditionToBaseQtyDnmntr:"0",ConditionToBaseQtyNmrtr:"0",ConditionType:"",ConditionType_fc:3,ConditionUpperLimit:"0.000",ConditionValidityEndDate_fc:3,ConditionValidityStartDate_fc:3,ConfigurationNumber:"000000000000000000",ConfigurationNumber_fc:3,ConsumptionTaxCtrlCode:"",ConsumptionTaxCtrlCode_fc:3,County:"",County_fc:3,CreatedByUser:"RONGF",Customer:"",CustomerGroup:"",CustomerGroup_fc:3,CustomerHierarchy:"",CustomerHierarchy_fc:3,CustomerName:"",CustomerPriceGroup:"",CustomerPriceGroup_fc:3,CustomerTaxClassification1:"",CustomerTaxClassification1_fc:3,CustomerTaxClassification2:"",CustomerTaxClassification2_fc:3,CustomerTaxClassification3:"",CustomerTaxClassification3_fc:3,CustomerTaxClassification4:"",CustomerTaxClassification4_fc:3,Customer_fc:3,DepartureCountry:"",DepartureCountry_fc:3,DestinationCountry:"",DestinationCountry_fc:3,DistributionChannel:"",DistributionChannelName:"",DistributionChannel_fc:3,Division:"",Division_fc:3,ETag:"",Edit_ac:false,EngagementProject:"",EngagementProjectName:"",EngagementProjectServiceOrg:"",EngagementProjectServiceOrg_fc:3,EngagementProject_fc:3,EngmtProjectServiceOrgName:"",Equipment:"",Equipment_fc:3,FixedValueDate:null,IncotermsClassification:"",IncotermsClassification_fc:3,IncotermsTransferLocation:"",IncotermsTransferLocation_fc:3,IncrementalScale:"0000",Industry:"",Industry_fc:3,InternationalArticleNumber:"",InternationalArticleNumber_fc:3,LocalSalesTaxApplicabilityCode:"",LocalSalesTaxApplicabilityCode_fc:3,MainItemMaterialPricingGroup:"",MainItemMaterialPricingGroup_fc:3,MainItemPricingRefMaterial:"",MainItemPricingRefMaterial_fc:3,Material:"",MaterialGroup:"",MaterialGroup_fc:3,MaterialName:"",MaterialPricingGroup:"",MaterialPricingGroup_fc:3,Material_fc:3,MaximumConditionAmount:"0.000",MaximumConditionBasisValue:"0.000",MinimumConditionBasisValue:"0.000",OrderQuantityUnit:"",OrderQuantityUnit_fc:3,PayerParty:"",PayerParty_fc:3,PaymentTerms:"",PersonFullName:"",Personnel:"00000000",Personnel_fc:3,Plant:"",PlantRegion:"",PlantRegion_fc:3,Plant_fc:3,PostalCode:"",PostalCode_fc:3,Preparation_ac:true,PriceListType:"",PriceListType_fc:3,PricingDate:null,PricingDate_fc:3,PricingScaleBasis:"",PricingScaleLine:"0000",PricingScaleType:"",ProductTaxClassification1:"",ProductTaxClassification1_fc:3,ProductTaxClassification2:"",ProductTaxClassification2_fc:3,ProductTaxClassification3:"",ProductTaxClassification3_fc:3,ProductTaxClassification4:"",ProductTaxClassification4_fc:3,ReferenceSDDocument:"",ReferenceSDDocumentItem:"000000",ReferenceSDDocumentItem_fc:3,ReferenceSDDocument_fc:3,Region:"",Region_fc:3,RequirementSegment:"",RequirementSegment_fc:3,ReturnsRefundExtent:"",ReturnsRefundExtent_fc:3,SDDocument:"",SDDocument_fc:3,SalesDocument:"",SalesDocumentItem:"000000",SalesDocumentItem_fc:3,SalesDocument_fc:3,SalesGroup:"",SalesGroup_fc:3,SalesOffice:"",SalesOffice_fc:3,SalesOrderSalesOrganization:"",SalesOrderSalesOrganization_fc:3,SalesOrganization:"",SalesOrganizationName:"",SalesOrganization_fc:3,SalesSDDocumentCategory:"",SalesSDDocumentCategory_fc:3,ServiceDocument:"",ServiceDocumentItem:"000000",ServiceDocumentItem_fc:3,ServiceDocument_fc:3,ShipToParty:"",ShipToParty_fc:3,SoldToParty:"",SoldToParty_fc:3,StockSegment:"",StockSegment_fc:3,Supplier:"",Supplier_fc:3,TaxCode:"",TaxCode_fc:3,TaxJurisdiction:"",TaxJurisdiction_fc:3,TechnicalObjectType:"",TechnicalObjectType_fc:3,TimeSheetOvertimeCategory:"",TimeSheetOvertimeCategory_fc:3,TradingContract:"",TradingContractItem:"000000",TradingContractItem_fc:3,TradingContract_fc:3,TransactionCurrency:"",TransactionCurrency_fc:3,TxRlvnceClassfctnForArgentina:"",TxRlvnceClassfctnForArgentina_fc:3,ValidOnDate:null,Validation_ac:true,ValueAddedServiceChargeCode:"",ValueAddedServiceChargeCode_fc:3,VariantCondition:"",VariantCondition_fc:3,WBSDescription:"",WBSElementInternalID:"",WBSElementInternalID_fc:3,WorkItem:"",WorkItemName:"",WorkItem_fc:3,WorkPackage:"",WorkPackageName:"",WorkPackage_fc:3,ReturnReason:"",Status:"D",ReturnReason_fc:3,ConditionToBaseQtyNmrtr_fc:3,ConditionToBaseQtyDnmntr_fc:3,BaseUnit_fc:3,ConditionTypeName:"",ConditionCalculationTypeName:"",DepartureCountryName:"",SalesDocumentItemText:"",BillableControlName:"",IndustryKeyText:"",CityCodeName:"",CountyName:"",TechnicalObjectTypeDesc:"",EquipmentName:"",IncotermsClassificationName:"",CustomerGroupName:"",CustomerPriceGroupName:"",SoldToPartyName:"",PayerPartyName:"",ShipToPartyName:"",SupplierName:"",DestinationCountryName:"",MaterialGroupName:"",ReturnsRefundExtentDesc:"",AdditionalMaterialGroup1Name:"",AdditionalMaterialGroup2Name:"",AdditionalMaterialGroup3Name:"",AdditionalMaterialGroup4Name:"",AdditionalMaterialGroup5Name:"",PriceListTypeName:"",RegionName:"",TimeSheetOvertimeCategoryText:"",CommodityCodeText:"",TaxJurisdictionName:"",MaterialPricingGroupName:"",VariantConditionName:"",SalesOfficeName:"",SalesGroupName:"",TransactionCurrencyName:"",PlantName:"",SDDocumentCategoryName:"",DivisionName:"",SlsOrderSalesOrganizationName:"",OrderQuantityUnitName:"",PlantRegionName:"",MainItmMatlPricingGroupName:"",MainItemPricingRefMaterialName:"",ProductHierarchyNode:"",ProductHierarchyNode_fc:3,ProductHierarchyNodeText:"",ShippingType:"",ShippingType_fc:3,ShippingTypeName:"",CustomerConditionGroup:"",CustomerConditionGroup_fc:3,ConditionText:"",ConditionText_fc:3,PaymentTerms_fc:3,PaymentTermsName:"",FixedValueDate_fc:3,AdditionalValueDays_fc:3,SalesPriceApprovalRequest:""};var P=Object.getOwnPropertyNames(w);for(var x in P){if(!a.getParameter("oEntity").hasOwnProperty(P[x])){a.getParameter("oEntity")[P[x]]=w[P[x]];}}if(!a.getParameter("oEntity").hasOwnProperty("ConditionValidityEndDate")){a.getParameter("oEntity").ConditionValidityEndDate="/Date("+ +new Date("Dec 31 9999 08:00:00")+")/";}if(!a.getParameter("oEntity").hasOwnProperty("ConditionValidityStartDate")){a.getParameter("oEntity").ConditionValidityStartDate="/Date("+ +new Date(v)+")/";}};m.attachAfter("POST",p,"C_SlsPricingConditionRecordTP");var t=function(a){if(a.getParameter("oEntity").IsActiveEntity===false||a.getParameter("oEntity").IsActiveEntity.search("false")!==-1){a.getParameter("oEntity").IsActiveEntity=false;}else if(a.getParameter("oEntity").IsActiveEntity===true||a.getParameter("oEntity").IsActiveEntity.search("true")!==-1){a.getParameter("oEntity").IsActiveEntity=true;}if(a.getParameter("oEntity").ConditionTable===undefined){a.getParameter("oEntity").SalesOrganization="0001";a.getParameter("oEntity").DistributionChannel="01";a.getParameter("oEntity").Material="T001";a.getParameter("oEntity").Personnel="00000001";a.getParameter("oEntity").WorkPackage="RELIMPLEMENTSAP.1.4";a.getParameter("oEntity").WorkItem="P002";a.getParameter("oEntity").EngagementProject="00000352";a.getParameter("oEntity").ConditionRateValue="100.00";a.getParameter("oEntity").ConditionRateValueUnit="EUR";a.getParameter("oEntity").ConditionQuantity="1";a.getParameter("oEntity").ConditionQuantityUnit="H";a.getParameter("oEntity").ConditionCalculationType="C";}};m.attachAfter("MERGE",t,"C_SlsPricingConditionRecordTP");var G=function(a){var v=a.getParameter("oFilteredData");if(v!==undefined){for(var i=0;i<v.__count/2;i++){var T=v.results[v.__count-1-i];v.results[v.__count-1-i]=v.results[i];v.results[i]=T;}}};m.attachAfter("GET",G,"C_SlsPricingConditionRecordTP");m.start();L.info("Running the app with mock data");r();A.forEach(function(a){var i=D[a],v=i.uri,w=q.sap.getModulePath(_+i.settings.localUri.replace(".xml",""),".xml");new M({rootUri:v,requests:[{method:"GET",path:RegExp(/((\w|\W)+|)/),response:function(x){q.sap.require("jquery.sap.xml");var y=q.sap.sjax({url:w,dataType:"xml"}).data;x.respondXML(200,{},q.sap.serializeXML(y));return true;}}]}).start();});});d.attachRequestFailed(function(){var e="Failed to load application manifest";L.error(e);R(new Error(e));});});},getMockServer:function(){return m;}};return o;});
