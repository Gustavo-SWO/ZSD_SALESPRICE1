/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["./BaseController","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/MessageType","../util/DynamicalAreaUtil","sap/ui/generic/app/navigation/service/NavigationHandler","sap/ui/comp/state/UIState"],function(B,f,F,a,M,D,N,U){"use strict";return B.extend("zzcus.sd.salesprices.manage.controller.Worklist",{formatter:f,aTables:[],aTypes:[],aShowObj:[],aCopyFields:[],aBingFilters:[],sSelectAll:"",vQuantityPos:"",vConditionTablePos:"",vEditStatusPos:"",iSizeBeforeCreate:0,iRowHeight:0,bValueChange:false,bTableChange:false,bQuantityUnitChange:false,bMaterialChange:false,bCalculationType:false,bSearch:false,sPopInfo:"",iTotalEditableRecords:0,iTotalRecords:0,bRateValueError:false,sRateValueField:"",bOnInitFinished:false,bFilterBarInitialized:false,bApproveFeature:false,aRequestConditions:[],bRateValueUnitchanged:false,vConditionLowerLimitPos:"",vConditionUpperLimitPos:"",onInit:function(){this._clearMsg();var i=new sap.ui.model.json.JSONModel();this.setModel(i,"message");this._oResourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this._oSmartTable=this.byId("LineItemsSmartTable");this._oSmartFilterBar=this.byId("smartFilterBar");this._oTable=this._oSmartTable.getTable();this._oDraftIndi=this.byId("draftIndi");this._oDynamicPage=this.byId("listPage");this._oBusyModel=new sap.ui.model.json.JSONModel({isBusy:false,isVisible:false,sApproveInfo:""});this.setModel(this._oBusyModel,"busy");this._oTable.setSelectionMode("MultiToggle");var p=new sap.ui.table.plugins.MultiSelectionPlugin({limit:0,enableNotification:true});p.attachSelectionChange(this._onRowSelectionChange,this);this._oPlugins=p;this._oTable.addPlugin(p);this._oTable.attachRowSelectionChange(this._onRowSelectionChange,this);this._oTable.attachParseError(this._onPopMsg,this);this._oTable.attachValidationError(this._onPopMsg,this);this.oNavigationHandler=new N(this);this.bOnInitFinished=true;this.initAppState();var t=new sap.m.Text({text:{parts:[{path:"Status"},{path:"i18n>draft"},{path:"i18n>noAuthorization"},{path:"i18n>blockedCustomer"},{path:"i18n>unchanged"}],formatter:function(s,d,n,b,u){var S;switch(s){case"A":S=n;break;case"B":S=b;break;case"D":S=d;break;case"U":S=u;break;}return S;}}});this.oTemplate=new sap.ui.layout.HorizontalLayout({content:[t]});var I="ConditionRecordUUID,ConditionSequentialNumber,ConditionApplication,CreatedByUser,CreationDate,ConditionTextID,CndnMaxNumberOfSalesOrders,"+"PricingScaleType,PricingScaleBasis,ConditionScaleQuantity,ConditionScaleQuantityUnit,ConditionScaleAmount,ConditionScaleAmountCurrency,"+"ConditionAlternativeCurrency,ConditionTypeName,MainItmMatlPricingGroupName,MainItemPricingRefMaterialName,"+"MaximumConditionBasisValue,MaximumConditionAmount,IncrementalScale,ValidOnDate,AccessNumberOfAccessSequence,ConditionIsDeleted,"+"ETag,ConditionRecordIsEditable,MaterialName,PersonFullName,WorkPackageName,WBSDescription,DistributionChannelName,SalesOrganizationName,PaymentTermsName,"+"EngmtProjectServiceOrgName,CustomerName,PricingScaleLine,WorkItemName,EngagementProjectName,ConditionQuantityUnit,MinimumConditionBasisValue,"+"ConditionCalculationTypeName,DepartureCountryName,SalesDocumentItemText,BillableControlName,IndustryKeyText,CityCodeName,CountyName,ConditionExclusion,"+"TechnicalObjectTypeDesc,EquipmentName,IncotermsClassificationName,CustomerGroupName,CustomerPriceGroupName,SoldToPartyName,PayerPartyName,"+"ShipToPartyName,SupplierName,DestinationCountryName,MaterialGroupName,ReturnsRefundExtentDesc,AdditionalMaterialGroup1Name,AdditionalMaterialGroup2Name,"+"AdditionalMaterialGroup3Name,AdditionalMaterialGroup4Name,AdditionalMaterialGroup5Name,PriceListTypeName,RegionName,TimeSheetOvertimeCategoryText,"+"CommodityCodeText,TaxJurisdictionName,MaterialPricingGroupName,VariantConditionName,SalesOfficeName,SalesGroupName,TransactionCurrencyName,PlantName,"+"SDDocumentCategoryName,DivisionName,SlsOrderSalesOrganizationName,OrderQuantityUnitName,PlantRegionName,ConditionRecordIsDraft,ProductHierarchyNodeText,"+"AccountTaxType,ConsumptionTaxCtrlCode,BRSpcfcTaxBasePercentageCode,BRSpcfcTxGrpDynTaxExceptions,CustomerTaxClassification1,CustomerTaxClassification2,"+"CustomerTaxClassification3,CustomerTaxClassification4,ProductTaxClassification1,ProductTaxClassification2,ProductTaxClassification3,ProductTaxClassification4,"+"TaxJurisdiction,BRSpcfcTaxDepartureRegion,BRSpcfcTaxDestinationRegion,TaxCode,BR_NFDocumentType,BRSpcfcFreeDefinedField1,BRSpcfcFreeDefinedField2,"+"BRSpcfcFreeDefinedField3,TxRlvnceClassfctnForArgentina,BR_TaxCode,LocalSalesTaxApplicabilityCode,ShippingTypeName,ConditionRateValueUnit,"+"ConditionChangeReason,ConditionChangeReasonText,ConditionReleaseStatusText";this._oSmartTable.setIgnoreFromPersonalisation(I);this.byId("edit").setEnabled(false);this.byId("export").setEnabled(false);this._handleFeature();},onExit:function(){if(this._oMessagePopover){this._oMessagePopover.destroy();}},onBeforeRebindTable:function(e){var b=e.getParameter("bindingParams");var t=this._oTable.getBinding();if(t===undefined){this._clearMsg();this.setModel(this.oMessageManager.getMessageModel(),"message");}this._getDraftStatus();var s=this._oDraftStatus.getSelectedKey();var c=[];if(b.filters.length===0&&s==="all"&&this.aShowObj.length>0){if(this.iSizeBeforeCreate<=this.aShowObj.length){for(var x=0;x<this.aShowObj.length;x++){c.push(new F("ConditionRecord",a.EQ,this.aShowObj[x]));}b.filters.push(new F({filters:c,and:false}));}return;}if(s!=="all"){switch(s){case"ownDraft":b.filters.push(new F("IsActiveEntity",a.EQ,false));break;case"unchanged":b.filters.push(new F({filters:[new F("IsActiveEntity",a.EQ,true),new F("HasDraftEntity",a.EQ,false)],and:true}));break;}}this._getFilterMethod();var d=this._oFilterMethod.getSelectedKey();var p=b.filters;this._parseDateFilter(p,b);if(p.length!==0&&p[0].aFilters){this._processNormalFilter(p,b,"ConditionRecord");}if(d==="OR"){this._parseFilterMethod(p,b);}this._rebuildFilter(b);this.aBingFilters=b;},onSFBAfterVariantLoad:function(e){this._createDynamicaAreaUtil();this._oDynamicalAreaUtil.aKeyFieldsResult=[];var c=e.getSource().getFilterData().ConditionType;if(c!==undefined){if(this._onGetFilterType(c)){return;}}else{this.aTypes=[];}var C=e.getSource().getFilterData().ConditionTable;if(C!==undefined){if(this._onGetFilterTable(C)){return;}}else{this.aTables=[];}if(this.aTypes.length>0){if(this.aTables.length>0){this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionType","values":this.aTypes},{"name":"ConditionTable","values":this.aTables}]);}else{this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionType","values":this.aTypes}]);}}else{if(this.aTables.length>0){this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionTable","values":this.aTables}]);}else{this._oDynamicalAreaUtil.setFilterValues();}}this._oDynamicalAreaUtil.changeDynamicalArea(undefined,undefined,true);},onSaveVariant:function(e){var u=this._oSmartTable.getUiState();var p=u.getPresentationVariant();var v=p.Visualizations[0];var V=this._oTable._getVisibleColumns();var s=false;if(v.Content.length!==V.length){s=true;}else{var c=[];for(var y=0;y<v.Content.length;y++){c.push(v.Content[y].Value);}for(var z=0;z<V.length;z++){var C=V[z].getId().split("-");var b=C[C.length-1];if(c.indexOf(b)===-1){s=true;break;}}}if(s){v.Content=[];for(var x=0;x<V.length;x++){C=V[x].getId().split("-");b=C[C.length-1];var o={};o.Value=b;v.Content.push(o);}this._oSmartTable.setUiState(u);}},onAssignedFiltersChanged:function(e){var s=this.byId("statusText");if(s&&this._oSmartFilterBar){var t=this._oSmartFilterBar.retrieveFiltersWithValuesAsText();s.setText(t);}},onFilterChange:function(e){this._clearMsg();this.aShowObj=[];this._oPlugins.clearSelection();this._setTableDisplayed();if(e.getParameter("afterFilterDataUpdate")||e.getParameter("sId")==="valueListChanged"||e.getParameter("mParameters")===undefined){return;}this.byId("create").setEnabled(false);this.byId("edit").setEnabled(false);this.byId("import").setEnabled(false);this.byId("export").setEnabled(false);var s=this._oSmartFilterBar.getControlByKey("EditingStatus").getSelectedKey();if(s==="ownDraft"){this.byId("download").setEnabled(false);}else{this.byId("download").setEnabled(true);}var i=e.getParameter("mParameters").id.toString().search("ConditionType");var I=e.getParameter("mParameters").id.toString().search("ConditionTable");if(i!==-1||I!==-1){this._createDynamicaAreaUtil();var S=e.getParameter("oSource");var n=this._oResourceBundle.getText("filterNotSupported");if(S.getValueStateText()===n){S.setValueState("None");S.setValueStateText("");}else if(S.getValueState()==="Error"){return;}this._buildDynamicFilter(S,i,I,n);}},onValueChange:function(e){this._removeMsg();if(this._oMessagePopover){this._oMessagePopover.close();}this._oDraftIndi.clearDraftState();this.bValueChange=true;var m=this.getModel();var s=e.getParameter("changeEvent").getSource();var b=s.getDataProperty().typePath;var t=s._sBindingContextPath+"/"+b;var c=this.oMessageManager.getMessageModel("message").getData();var u=e.getParameter("changeEvent").getParameter("unitChanged");if(u&&s.getInnerControls()[1].getValueState()==="Error"){s.getInnerControls()[1].setValue(m.getData(t+"Unit"));s.getInnerControls()[1].setValueState("None");s.getInnerControls()[1].setValueStateText("");}this.sRateValueField="";if(s.getValueState()==="Error"){var d=false;for(var i in c){if(c[i].target===t&&c[i].message===s.getValueStateText()){d=true;break;}}if(!d){this._addMsg(s.getValueStateText(),M.Error,t,s._sAnnotationLabel);}if(b!=="ConditionRateValue"&&b!=="ConditionLowerLimit"&&b!=="ConditionUpperLimit"){this._popMsg();}else{if(this.bRateValueError){this._popMsg();}else{this.sRateValueField=b;s.attachValidationSuccess(this._onRemoveErrorMsg,this);}}this.bRateValueError=false;return;}else{this._removeErrorMsg(c,t);m.bSequentializeRequests=true;this.bRateValueError=false;}if(b==="ConditionRateValue"||b==="ConditionLowerLimit"||b==="ConditionUpperLimit"){this.bRateValueUnitchanged=u;}else{this.bRateValueUnitchanged=false;}this._handleValueChange(e);},onSearch:function(e){this.getModel().resetChanges();this._clearMsg();this.aShowObj=[];this._oPlugins.clearSelection();this._setTableDisplayed();this.byId("create").setEnabled(true);var s=this._oSmartFilterBar.getControlByKey("EditingStatus").getSelectedKey();if(s==="ownDraft"){this.byId("import").setEnabled(false);this.byId("download").setEnabled(false);}else{this.byId("import").setEnabled(true);this.byId("download").setEnabled(true);}this.bSearch=true;this.storeCurrentAppState();},onAfterTableVariantSave:function(e){this.storeCurrentAppState();},onCreate:function(e){var m=this.getModel();m.resetChanges();this._clearMsg();this._oDraftIndi.clearDraftState();this.iSizeBeforeCreate=this._oTable.getTotalSize();if(this._checkGroup()){return;}var c=this._onBeforeCreate();this._oBusyModel.setProperty("/isBusy",true);m.setRefreshAfterChange(false);m.create("/C_SlsPricingConditionRecordTP",c,{success:function(d){this._setTableEditable();this.aShowObj.push(d.ConditionRecord);this._switchStatus("Create");this._oSmartTable.rebindTable(true);this._onRowSelectionChange();this._oBusyModel.setProperty("/isBusy",false);}.bind(this),error:function(d){this._processOneRequestFail(d);}.bind(this)});},onImport:function(e){var t=this;sap.ui.core.mvc.XMLView.create({viewName:"zzcus.sd.salesprices.manage.view.Upload",viewData:{controller:this}}).then(function(v){t.getView().addDependent(v);v.byId("uploadDialog").open();});},onExport1:function(e){this.onFileDownload(false);},onExport2:function(e){this.onFileDownload(true);},onFileDownload:function(w){var m=this.getModel();m.setRefreshAfterChange(false);m.setUseBatch(true);m.setDeferredGroups(["batchExportGroup"]);m.setHeaders({"DownloadExcel":"X"});this._oBusyModel.setProperty("/isBusy",true);m.read("/C_SlsPricingConditionRecordTP",{filters:this.aBingFilters.filters,groupId:"batchExportGroup",urlParameters:{"$top":"1"}});var t=(w)?"X":"";t=",TextFlag='"+t+"')";var s=this._fillDownloadDataSorter(this._oSmartTable);var p="/DownloadExcelSet(FilterString='filter',SorterString='"+s+"'"+t;m.read(p,{groupId:"batchExportGroup"});this._batchRequestForDownloadData(m);},onFileTemplateDownload:function(){var o=this._oSmartFilterBar.getFilters();if(o.length){var b=this._fillDownloadTemplateFilter(o);var s=this._parseTemplateFilterToString(b.aFilterType,b.aFilterTable);}else{s="";}var p="/DownloadExcelTemplateSet(FilterString='"+s+"')/$value";var c=this.getOwnerComponent().getModel().sServiceUrl+p;sap.m.URLHelper.redirect(c,false);},onHistory:function(e){this.storeCurrentAppState();var r=this.getRouter();r.navTo("history");},onEdit:function(e){this._clearMsg();this._oDraftIndi.clearDraftState();var t=this._oTable.getBinding();if(t===undefined){this._addMsg(this._oResourceBundle.getText("noDataFoundText"),M.Information);this._popMsg();return;}else{var T=t.getLength();if(T===0){this._addMsg(this._oResourceBundle.getText("noDataFoundText"),M.Information);this._popMsg();return;}else{if(this._checkGroup()){return;}}}this._oBusyModel.setProperty("/isBusy",true);var m=this.getModel();m.setRefreshAfterChange(false);var E=this._buildEditData();if(E.bEdit){m.callFunction("/AE3B72B4F1AA3073D427AEditconditionrecord",{"method":"POST",urlParameters:{ConditionRecordUUID:E.sRecordUUIDs,IsActiveEntity:true,Preservechanges:true,Totalcount:E.iRequestTotalCount},success:function(d,r){this._clearMsg();var n=[];var i=[];var I=[];var s=r.headers["sap-message"];if(s){this._prepareMessage("noEditAuthority",s,n,i,I);}this._setTableEditable();this._switchStatus("Edit");this._oSmartTable.rebindTable(true);this._onRowSelectionChange();this._showMessage(n,i,I,false,"createDraftFailText");this._oBusyModel.setProperty("/isBusy",false);}.bind(this),error:function(d){this._processOneRequestFail(d);}.bind(this)});}else{this._oBusyModel.setProperty("/isBusy",false);this._setTableEditable(E.bIsGroup);this._onRowSelectionChange();var c=this._oTable.getContextByIndex(0);if(c!==undefined&&c.getProperty("IsActiveEntity")){this._setTableDisplayed();}if(this.sPopInfo!==""){this._addMsg(this._oResourceBundle.getText(this.sPopInfo),M.Information);this._popMsg();}}},onCancel:function(e){this._clearMsg();this._oDraftIndi.clearDraftState();sap.m.MessageBox.warning(this.getText("cancelQuestionText"),{actions:[sap.m.MessageBox.Action.DELETE,sap.m.MessageBox.Action.CANCEL],onClose:function(c){var m=this.getModel();m.resetChanges();var t=this._oTable.getBinding().getLength();if(c===sap.m.MessageBox.Action.DELETE){this._oBusyModel.setProperty("/isBusy",true);m.setUseBatch(true);m.setDeferredGroups(["batchDeleteDraft"]);m.setRefreshAfterChange(false);var C;for(var x=0;x<t;x++){var o=this._oTable.getContextByIndex(x);if(o){var s=o.sPath.search("IsActiveEntity=")+15;var i=o.sPath.substr(s,5);if(i==="false"){C=true;m.remove(o.sPath,{groupId:"batchDeleteDraft"});}}else{break;}}if(C){m.submitChanges({groupId:"batchDeleteDraft",success:function(d){this._processSuccess(d,"deleteDraftFailText");}.bind(this),error:function(d){this._processFail(d);}.bind(this)});}else{this._oBusyModel.setProperty("/isBusy",false);this._setTableDisplayed();this._switchStatus("Cancel");this._oSmartTable.rebindTable(true);this._onRowSelectionChange();}}else{this._setTableDisplayed();this._switchStatus("Cancel");if(Object.keys(this._oSmartFilterBar.getFilterData()).length===0){this.aShowObj=[];}this._oSmartTable.rebindTable(true);this._onRowSelectionChange();}}.bind(this)});},onSave:function(e){this._removeMsg();this._oDraftIndi.clearDraftState();if(this._checkBeforeSave()){this._popMsg();return;}this.iTotalEditableRecords=0;var m=this.getModel();m.setRefreshAfterChange(false);m.setUseBatch(true);m.setDeferredGroups(["batchSaveGroup"]);this._oBusyModel.setProperty("/isBusy",true);var s;var t=this._oTable.getBinding().getLength();for(var x=0;x<t;x++){var c=this._oTable.getContextByIndex(x);if(c){var S=c.sPath.search("IsActiveEntity=")+15;var i=c.sPath.substr(S,5);if(i==="false"){s=true;S=c.sPath.search("ConditionRecordUUID=guid'")+25;var r=c.sPath.substr(S,36);m.callFunction("/C_SlsPricingConditionRecordTPActivation",{"method":"POST",urlParameters:{ConditionRecordUUID:r,IsActiveEntity:i},groupId:"batchSaveGroup"});this.iTotalEditableRecords++;}}else{break;}}if(s){m.bSequentializeRequests=true;m.submitChanges({groupId:"batchSaveGroup",success:function(d){this._processSuccess(d,"saveConditionFailText");}.bind(this),error:function(d){this._processFail(d);}.bind(this)});}else{this._oBusyModel.setProperty("/isBusy",false);this._setTableDisplayed();this._switchStatus("Save");this._oSmartTable.rebindTable(true);this._onRowSelectionChange();}},onRequestApprove:function(e){this._clearMsg();this._oDraftIndi.clearDraftState();if(this._selectRowCheck()){return;}if(this._checkGroup()){return;}var A=this._buildAQData();this._oBusyModel.setProperty("/isBusy",true);var m=this.getModel();m.setRefreshAfterChange(false);if(A.bSend){this.aRequestConditions=[];m.callFunction("/C_SlsPricingConditionRecordTPSimulate",{"method":"POST",urlParameters:{ConditionRecordUUID:A.sRecordUUIDs,IsActiveEntity:true,Preservechanges:true,Totalcount:A.iRequestTotalCount},success:function(d,r){this._processAQSuccess(r,"requestSimulation",A.bAll);}.bind(this),error:function(d){this._processOneRequestFail(d);}.bind(this)});}else{this._oBusyModel.setProperty("/isBusy",false);}},onSubmitRequest:function(e){if(this._oDescription.getValue()===""){this._oDescription.setValueState("Error");this._oDescription.setValueStateText(this._oResourceBundle.getText("noEntry"));}if(this._oDescription.getValueState()!=="None"){this._oDescription.focus();}else{this._closeApproveDialog();this._clearMsg();this._oBusyModel.setProperty("/isBusy",true);var r="";for(var i=0;i<this.aRequestConditions.length;i++){if(r===""){r=this.aRequestConditions[i];}else{r=r+","+this.aRequestConditions[i];}}var m=this.getModel();m.setRefreshAfterChange(false);m.callFunction("/AE3B72B4F1AA3073D427A3Requestforapproval",{"method":"POST",urlParameters:{ConditionRecordUUID:r,IsActiveEntity:true,Preservechanges:true,Totalcount:this.aRequestConditions.length},success:function(d,R){this._processAQSuccess(R,"submitApproval");}.bind(this),error:function(d){this._processOneRequestFail(d);}.bind(this)});}},onCloseApprove:function(e){this._closeApproveDialog();},onInputChange:function(e){var s=e.getSource();var i=s.getValue();if(i===""){s.setValueState("Error");s.setValueStateText(this._oResourceBundle.getText("noEntry"));}else{s.setValueState("None");s.setValueStateText("");}},onCopy:function(e){this._clearMsg();this._oDraftIndi.clearDraftState();if(this._selectRowCheck()){return;}if(this._checkActivedata()){return;}else{this.iSizeBeforeCreate=this._oTable.getTotalSize();if(this._checkGroup()){return;}}var m=this.getModel();m.setRefreshAfterChange(false);m.setUseBatch(true);m.setDeferredGroups(["batchCopyGroup"]);this._oBusyModel.setProperty("/isBusy",true);var s=[];if(this.sSelectAll==="true"){var t=this._oTable.getBinding().getLength();for(var y=0;y<t;y++){s.push(y);}}else{s=this._oPlugins.getSelectedIndices();}this.sPopInfo="";var c;for(var x=0;x<s.length;x++){var C=this._oTable.getContextByIndex(s[x]);if(C){var o=m.getData(C.sPath);if(o.Status==="U"){this._buildCopyData(C);c=true;}else if(o.Status==="A"){this.sPopInfo="copyinfomsg";}else if(o.Status==="B"){this.sPopInfo="copyinfomsg";}}else{break;}}if(c){m.submitChanges({groupId:"batchCopyGroup",success:function(d){this._processSuccess(d,"copyConditionFailText");}.bind(this),error:function(d){this._processFail(d);}.bind(this)});}else{this._oBusyModel.setProperty("/isBusy",false);this._addMsg(this._oResourceBundle.getText(this.sPopInfo),M.Information);this._popMsg();}},onDelete:function(e){this._clearMsg();this._oDraftIndi.clearDraftState();if(this._selectRowCheck()){return;}if(this._checkGroup()){return;}if(!this._checkDeleteData()){this._addMsg(this._oResourceBundle.getText("deleteWFerror"),M.Error);this._popMsg();return;}sap.m.MessageBox.warning(this._oResourceBundle.getText("deleteConditionText"),{title:this._oResourceBundle.getText("delete"),actions:[sap.m.MessageBox.Action.DELETE,sap.m.MessageBox.Action.CANCEL],onClose:function(c){if(c===sap.m.MessageBox.Action.DELETE){this._deleteConditions();}}.bind(this)});},onDataReceived:function(e){var c=this._oTable.getBinding().iTotalSize;this.iTotalRecords=c;if(c===-1&&this.bSearch){this.bSearch=false;this._oSmartTable.rebindTable(true);return;}else{this.bSearch=false;}if(!this.byId("create").getEnabled()){this.byId("create").setEnabled(true);}var s=this._oSmartFilterBar.getControlByKey("EditingStatus").getSelectedKey();if(s==="ownDraft"){this.byId("import").setEnabled(false);this.byId("download").setEnabled(false);}else{this.byId("import").setEnabled(true);this.byId("download").setEnabled(true);}if(c==="0"||c<=0){this._setTableDisplayed();this.byId("edit").setEnabled(false);this.byId("export").setEnabled(false);var d=e.getParameter("mParameters").data;if(d!==undefined&&d.__batchResponses[0].headers["sap-message"]!==undefined){this._popMsg();}}else{if(!this._oSmartTable.getEditable()){this.byId("edit").setEnabled(this.byId("create").getEnabled());if(this._oSmartFilterBar.getFilters().length){if(s==="unchanged"||s==="all"){this.byId("export").setEnabled(this.byId("create").getEnabled());}}}else{var C=this._oTable.getContextByIndex(0);if(C!==undefined&&C.getProperty("IsActiveEntity")){this._setTableDisplayed();}}}this._setColumnWidth();this._oTable.setRowHeight(this.iRowHeight);},onInitSmartTable:function(e){var c=["ConditionValidityStartDate","ConditionValidityEndDate","ConditionRateValue","ConditionQuantity","ConditionLowerLimit","ConditionUpperLimit","ConditionText","PaymentTerms","FixedValueDate","AdditionalValueDays","ConditionToBaseQtyNmrtr","ConditionToBaseQtyDnmntr","BaseUnit","ConditionCalculationType","ConditionRecord","SalesPriceApprovalRequest","ConditionProcessingStatus","ConditionReleaseStatus","Status"];var s=["PaymentTerms","FixedValueDate","AdditionalValueDays","ConditionToBaseQtyNmrtr","ConditionText","ConditionToBaseQtyDnmntr","BaseUnit","ConditionLowerLimit","ConditionUpperLimit","ConditionCalculationType","ConditionRateValue","ConditionRecord","SalesPriceApprovalRequest","ConditionProcessingStatus","ConditionReleaseStatus"];var u=this._oSmartTable.getUiState();var p=u.getPresentationVariant();var v=p.Visualizations[0];v.Content=[];this.aCopyFields=[];var C=this._oTable.getColumns();for(var m=0;m<C.length;m++){var b=C[m].getId().split("-");var d=b[b.length-1];if(d==="Status"){C[m].setTemplate(this.oTemplate);this.vEditStatusPos=m;C[m].setShowSortMenuEntry(false);}else if(d==="ConditionQuantity"){this.vQuantityPos=m;C[m].setShowSortMenuEntry(false);}else if(d==="ConditionTable"){C[m].setShowSortMenuEntry(false);this.vConditionTablePos=m;}else if(d==="ConditionLowerLimit"){this.vConditionLowerLimitPos=m;C[m].setShowSortMenuEntry(false);}else if(d==="ConditionUpperLimit"){this.vConditionUpperLimitPos=m;C[m].setShowSortMenuEntry(false);}else if(s.indexOf(d)!==-1){C[m].setShowSortMenuEntry(false);}this.aCopyFields.push(d);if(c.indexOf(d)===-1){var V={};V.Value=d;v.Content.push(V);}}var I=this._oSmartTable.getIgnoreFromPersonalisation().split(",");for(var i in this._oSmartTable._aColumnKeys){if(this.aCopyFields.indexOf(this._oSmartTable._aColumnKeys[i])!==-1||I.indexOf(this._oSmartTable._aColumnKeys[i])!==-1){continue;}else{this.aCopyFields.push(this._oSmartTable._aColumnKeys[i]);var o={};o.Value=this._oSmartTable._aColumnKeys[i];v.Content.push(o);}}for(var n=0;n<c.length;n++){var g={};g.Value=c[n];v.Content.push(g);}this._oSmartTable.setUiState(u);this.iRowHeight=this._oTable._getBaseRowHeight();},onInitSmartFilterBar:function(e){this.bFilterBarInitialized=true;this.initAppState();var b=this._oSmartFilterBar.getAllFilterItems();for(var i in b){if(b[i].getGroupName()==="DraftAdministrativeData"||b[i].getName()==="ConditionIsExclusive"){b[i].setVisible(false);}}},initAppState:function(){if(!(this.bFilterBarInitialized&&this.bOnInitFinished)){return;}var p=this.oNavigationHandler.parseNavigation();var t=this;p.done(function(A,s,n){if(n!==sap.ui.generic.app.navigation.service.NavType.initial){var h=A&&A.bNavSelVarHasDefaultsOnly;var S=new sap.ui.generic.app.navigation.service.SelectionVariant(A.selectionVariant);var b=S.getParameterNames().concat(S.getSelectOptionsPropertyNames());if(n===sap.ui.generic.app.navigation.service.NavType.URLParams&&b.length===1&&b[0]==="openMode"){return;}var u={replace:true,strictMode:false};var o=new U({selectionVariant:JSON.parse(A.selectionVariant),semanticDates:A.semanticDates});for(var i=0;i<b.length;i++){t._oSmartFilterBar.addFieldToAdvancedArea(b[i]);}if(!h||t._oSmartFilterBar.getCurrentVariantId()===""){t._oSmartFilterBar.clearVariantSelection();t._oSmartFilterBar.clear();t._oSmartFilterBar.setUiState(o,u);}if(A.tableVariantId){t._oSmartTable.setCurrentVariantId(A.tableVariantId);}t.restoreCustomAppStateData(A.customData);this._setFilterFromRestore(A,t);this._oDynamicalAreaUtil.changeDynamicalArea(true);}}.bind(this));p.fail(function(e){t._handleError(e);});},storeCurrentAppState:function(){var A=this.oNavigationHandler.storeInnerAppState(this.getCurrentAppState());A.done(function(s){});A.fail(function(e){this._handleError(e);}.bind(this));return A;},getCurrentAppState:function(){var s=new sap.ui.generic.app.navigation.service.SelectionVariant(JSON.stringify(this._oSmartFilterBar.getUiState().getSelectionVariant()));return{selectionVariant:s.toJSONString(),tableVariantId:this._oSmartTable.getCurrentVariantId(),customData:this.getCustomAppStateData(),semanticDates:this._oSmartFilterBar.getUiState().getSemanticDates()};},getCustomAppStateData:function(){return{};},restoreCustomAppStateData:function(c){},_setFilterFromRestore:function(A){if(A.oSelectionVariant!==undefined){this.aTypes=[];this.aTables=[];if(A.oSelectionVariant.getSelectOption("ConditionType")!==undefined){for(var m=0;m<A.oSelectionVariant.getSelectOption("ConditionType").length;m++){this.aTypes.push({key:A.oSelectionVariant.getSelectOption("ConditionType")[m].Low});}}if(A.oSelectionVariant.getSelectOption("ConditionTable")!==undefined){for(var t=0;t<A.oSelectionVariant.getSelectOption("ConditionTable").length;t++){this.aTables.push({key:A.oSelectionVariant.getSelectOption("ConditionTable")[t].Low});}}this._oBusyModel.setProperty("/isBusy",true);this._createDynamicaAreaUtil();if(this.aTypes.length>0){if(this.aTables.length>0){this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionType","values":this.aTypes},{"name":"ConditionTable","values":this.aTables}]);}else{this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionType","values":this.aTypes}]);}}else{if(this.aTables.length>0){this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionTable","values":this.aTables}]);}else{this._oDynamicalAreaUtil.setFilterValues();}}}},_selectRowCheck:function(){var s=this._oPlugins.getSelectedIndices();if(s.length<1){this._addMsg(this._oResourceBundle.getText("selectConditionText"),M.Error);this._popMsg();return true;}else{return false;}},_deleteConditions:function(){this.iTotalEditableRecords=0;this._clearMsg();this._oDraftIndi.clearDraftState();this._oBusyModel.setProperty("/isBusy",true);var m=this.getModel();m.setRefreshAfterChange(false);m.setUseBatch(true);m.setDeferredGroups(["batchDeleteCondition"]);var s=[];if(this.sSelectAll==="true"){var t=this._oTable.getBinding().getLength();for(var y=0;y<t;y++){s.push(y);}}else{s=this._oPlugins.getSelectedIndices();}var d=this._prepareDeleteData(s);if(d.bDelete){m.callFunction("/AE3B72B4F1AA3073D42Deleteconditionrecord",{"method":"POST",urlParameters:{ConditionRecordUUID:d.sRecordUUIDs,IsActiveEntity:true,Preservechanges:true,Totalcount:d.iRequestTotalCount},groupId:"batchDeleteCondition"});}if(d.bDeleteSend){m.submitChanges({groupId:"batchDeleteCondition",success:function(o){this._processSuccess(o,"deleteConditionFail");}.bind(this),error:function(o){this._processFail(o);}.bind(this)});}else{this._oBusyModel.setProperty("/isBusy",false);this._addMsg(this._oResourceBundle.getText(this.sPopInfo),M.Information);this._popMsg();}},_onRowSelectionChange:function(e){if(e&&e.getParameter("selectAll")&&e.getParameter("selectAll")===true){this.sSelectAll="true";}else{this.sSelectAll="false";}var E=this._oSmartTable.getEditable();var s=this._oPlugins.getSelectedIndices();if(!E&&s.length>0){this.byId("create").setEnabled(false);this.byId("edit").setEnabled(false);var c=this._checkSelectedData();this.byId("requestApprove").setEnabled(c.bSend);this.byId("copy").setEnabled(c.bCopy);this.byId("delete").setEnabled(c.bDelete);}else{this.byId("create").setEnabled(true);this.byId("edit").setEnabled(true);this.byId("copy").setEnabled(false);this.byId("delete").setEnabled(false);this.byId("requestApprove").setEnabled(false);}var S=this._oSmartFilterBar.getControlByKey("EditingStatus").getSelectedKey();if(S==="unchanged"||S==="all"){if(s.length>0||this._oSmartFilterBar.getFilters().length===0){this.byId("export").setEnabled(false);}else{this.byId("export").setEnabled(true);}}},_getDraftStatus:function(){if(!this._oDraftStatus){this._oDraftStatus=this._oSmartFilterBar.getControlByKey("EditingStatus");}},_getFilterMethod:function(){if(!this._oFilterMethod){this._oFilterMethod=this._oSmartFilterBar.getControlByKey("FilterMethod");}},_onRequestSent:function(e){if(e.getParameter("requests")[0].method==="MERGE"&&this.bValueChange===true){this._oDraftIndi.showDraftSaving();}this.getModel().bSequentializeRequests=false;this.bValueChange=false;},_onRequestCompleted:function(e){if(e.getParameter("requests")[0].method==="MERGE"){var m=this.getModel();var p=e.getParameter("requests")[0].url.split("?")[0];var s="/"+p;if(e.getParameter("requests")[0].success===true){if(this.bTableChange){this._oDynamicalAreaUtil.changeDynamicalArea(undefined,true);}if(this.bQuantityUnitChange||this.bMaterialChange||this.bCalculationType||this.bRateValueUnitchanged){this._oBusyModel.setProperty("/isBusy",true);m.createBindingContext(s,null,null,this._refectEntry.bind(this),true);this._clearValueState(p);}this._oDraftIndi.showDraftSaved();}else{this._oDraftIndi.clearDraftState();var b=this.oMessageManager.getMessageModel("message").getData();for(var i in b){if(b[i].technical&&b[i].technicalDetails!==undefined){this.oMessageManager.removeMessages(b[i]);}}}this.bTableChange=false;this.bQuantityUnitChange=false;this.bMaterialChange=false;this.bCalculationType=false;this.bRateValueUnitchanged=false;}},_onRequestFailed:function(e){if(e.getParameter("requests")[0].method==="MERGE"){var m=this.getModel();var u=e.getParameter("requests")[0].url.split("?")[0];var p=m.getPendingChanges()[u];if(p!==undefined&&p.ConditionRateValue!==undefined){this._truncateRateValue(p,u,"ConditionRateValue");}else if(p!==undefined&&p.ConditionLowerLimit!==undefined){this._truncateRateValue(p,u,"ConditionLowerLimit");}else if(p!==undefined&&p.ConditionUpperLimit!==undefined){this._truncateRateValue(p,u,"ConditionUpperLimit");}}},_refectEntry:function(d){this._oBusyModel.setProperty("/isBusy",false);},_createDynamicaAreaUtil:function(){if(!this._oDynamicalAreaUtil){this._oDynamicalAreaUtil=new D(this._oSmartFilterBar,this._oSmartTable,this._oBusyModel);this._oDynamicalAreaUtil.setDataSource(this.getOwnerComponent().getModel(),"/I_SlsPrcgKeyCombinationField");}},_checkActivedata:function(){var s=this._oPlugins.getSelectedIndices();var i=[];for(var x=0;x<s.length;x++){var c=this._oTable.getContextByIndex(s[x]);if(c){var p=c.sPath;var S=p.search("IsActiveEntity=")+15;var I=p.substr(S,4);if(I!=="true"){var m=this.getModel();var r=m.getData(p).ConditionRecord;i.push(r);}}else{break;}}if(i.length>0){this._oBusyModel.setProperty("/isBusy",false);this._addMsg(this._oResourceBundle.getText("activeActionFailText"),M.Error);this._popMsg();return true;}else{return false;}},_processSuccess:function(d,m){this._clearMsg();var c=d.__batchResponses[0].__changeResponses;if(!c){this._handleResopnseError(d.__batchResponses[0].response.body);return;}var s=false;var n=[];var i=[];var I=[];if(m==="saveConditionFailText"){s=true;this._setTableDisplayed();var S=[];var b=c[0].headers["sap-message"];if(b){this._prepareMessage("noSaveAuthority",b,n,i,I,S);}this._switchStatus("Save");if(this.bApproveFeature===true&&S.length>0){this.aRequestConditions=[];this._triggerSaveWF(S);}}else if(m==="copyConditionFailText"){this._setTableEditable();for(var x=0;x<c.length;x++){this.aShowObj.push(c[x].data.ConditionRecord);}this._switchStatus("Copy");}else if(m==="deleteDraftFailText"){this._setTableDisplayed();this._switchStatus("Cancel");}else if(m==="deleteConditionFail"){s=true;b=c[0].headers["sap-message"];if(b){this._prepareMessage("noDeleteAuthority",b,n,i,I);}}this._oSmartTable.rebindTable(true);this._onRowSelectionChange();this._showMessage(n,i,I,s,m);this._oBusyModel.setProperty("/isBusy",false);},_processAQSuccess:function(r,m,A){this._clearMsg();var o=r.headers["sap-message"];if(!o){return;}this._oBusyModel.setProperty("/isBusy",false);if(m==="requestSimulation"){var b=JSON.parse(o);var s=b.message.split("/");var w=[];var R=[];if(s.length>1){R.push(s[0]);w.push(s[1]);}for(var z=0;z<b.details.length;z++){s=b.details[z].message.split("/");if(s.length>1){if(R.indexOf(s[0])===-1){R.push(s[0]);}if(w.indexOf(s[1])===-1){w.push(s[1]);}}}if(w.length>0){this.aRequestConditions=R;this._createApproveDialog("requestApprove",w.length,A);}else{this._oSmartTable.rebindTable(true);this._onRowSelectionChange();}}else if(m==="submitApproval"){this._oSmartTable.rebindTable(true);this._onRowSelectionChange();b=JSON.parse(o);var c=[];c.push(b.message);for(z=0;z<b.details.length;z++){if(c.indexOf(b.details[z].message)===-1){c.push(b.details[z].message);}}for(z=0;z<c.length;z++){var d=this._oResourceBundle.getText("submitRequestText",c[z]);this._addMsg(d,M.Information);}this._popMsg();}},_processFail:function(d){this._oBusyModel.setProperty("/isBusy",false);this._clearMsg();var m=$(d.responseText).find("message").first().text();if(m!==""){this._addMsg(m,M.Error);this._popMsg();}else{}},_processOneRequestFail:function(d){this._oBusyModel.setProperty("/isBusy",false);this._clearMsg();try{var m=$(d.responseText).find("message").first().text();if(m!==""){this._addMsg(m,M.Error);this._popMsg();}else{}}catch(e){this._handleResopnseError(d.responseText);}},_setTableEditable:function(i){this._clearMsg();var e=this._oSmartTable.getEditable();if(!e&&!i){var m=this.getModel();m.setUseBatch(true);m.setRefreshAfterChange(false);m.setDeferredGroups(["batchDraft"]);this._oBusyModel.setProperty("/isVisible",true);this._oSmartTable.setEditable(true);m.attachBatchRequestSent(this._onRequestSent,this);m.attachBatchRequestCompleted(this._onRequestCompleted,this);m.attachBatchRequestFailed(this._onRequestFailed,this);}if(!this._oDynamicPage.getShowFooter()){this._oDynamicPage.setShowFooter(true);}},_setTableDisplayed:function(){this._oDraftIndi.clearDraftState();var e=this._oSmartTable.getEditable();if(e){this._oBusyModel.setProperty("/isVisible",false);this._oSmartTable.setEditable(false);var m=this.getModel();m.detachBatchRequestSent(this._onRequestSent,this);m.detachBatchRequestCompleted(this._onRequestCompleted,this);m.detachBatchRequestFailed(this._onRequestFailed,this);}if(this._oDynamicPage.getShowFooter()&&this.oMessageManager.getMessageModel("message").getData().length===0){this._oDynamicPage.setShowFooter(false);}},_setMessageType:function(m){var s;if(m==="info"){s=M.Information;}else if(m==="warning"){s=M.Warning;}else{s=M.Success;}return s;},_draftExist:function(t){var q=this._oResourceBundle.getText("warningTextFirst")+" \n ";for(var x=0;x<t.length;x++){q=q+" \n "+t[x];}q=q+" \n \n "+this._oResourceBundle.getText("warningTextLast");sap.m.MessageBox.warning(q,{actions:[this._oResourceBundle.getText("edit"),sap.m.MessageBox.Action.CANCEL],onClose:function(c){if(c===this._oResourceBundle.getText("edit")){this._takeOverDraft();}}.bind(this),initialFocus:this._oResourceBundle.getText("edit")});},_takeOverDraft:function(){this._clearMsg();this._oBusyModel.setProperty("/isBusy",true);var m=this.getModel();m.setRefreshAfterChange(false);var e=this._buildEditData();m.callFunction("/AE3B72B4F1AA3073D427AEditconditionrecord",{"method":"POST",urlParameters:{ConditionRecordUUID:e.sRecordUUIDs,IsActiveEntity:true,Preservechanges:false,Totalcount:e.iRequestTotalCount},success:function(d){this._clearMsg();var c=d.__batchResponses[0].__changeResponses;if(!c){this._handleResopnseError(d.__batchResponses[0].response.body);return;}this._switchStatus("Edit");this._takeOverCreateDraft();}.bind(this),error:function(d){this._processOneRequestFail(d);}.bind(this)});},_takeOverCreateDraft:function(){this._clearMsg();var m=this.getModel();m.setRefreshAfterChange(false);var e=this._buildEditData();m.callFunction("/AE3B72B4F1AA3073D427AEditconditionrecord",{"method":"POST",urlParameters:{ConditionRecordUUID:e.sRecordUUIDs,IsActiveEntity:true,Preservechanges:false,Totalcount:e.iRequestTotalCount},success:function(d,r){this._clearMsg();var n=[];var i=[];var I=[];var s=r.headers["sap-message"];if(s){this._prepareMessage("noEditAuthority",s,n,i,I);}this._setTableEditable();this._oSmartTable.rebindTable(true);this._onRowSelectionChange();this._showMessage(n,i,I,false,"createDraftFailText");this._oBusyModel.setProperty("/isBusy",false);}.bind(this),error:function(d){this._processOneRequestFail(d);}.bind(this)});},_setColumnWidth:function(){this._createDynamicaAreaUtil();var l=this._oDynamicalAreaUtil.iKeyFieldsNumber+this._oDynamicalAreaUtil.aDefaultColumns.length;for(var i=2;i<l;i++){if(i===this._oDynamicalAreaUtil.iKeyFieldsNumber+2||i===this._oDynamicalAreaUtil.iKeyFieldsNumber+3||i===this._oDynamicalAreaUtil.iKeyFieldsNumber+4){continue;}this._oTable.autoResizeColumn(i);}if(this.vQuantityPos!==""){this._oTable.getColumns()[this.vQuantityPos].setWidth("200px");}if(this.vConditionTablePos!==""){this._oTable.getColumns()[this.vConditionTablePos].setWidth("120px");}if(this.vEditStatusPos!==""){this._oTable.getColumns()[this.vEditStatusPos].setWidth("160px");}if(this.vConditionLowerLimitPos!==""){this._oTable.getColumns()[this.vConditionLowerLimitPos].setWidth("160px");}if(this.vConditionUpperLimitPos!==""){this._oTable.getColumns()[this.vConditionUpperLimitPos].setWidth("160px");}this._oTable.autoResizeColumn(0);},_buildEditData:function(){var e={bEdit:false,iRequestTotalCount:0,sRecordUUIDs:"",bIsGroup:true};var m=this.getModel();this.sPopInfo="";var t=this._oTable.getBinding().getLength();for(var x=0;x<t;x++){var c=this._oTable.getContextByIndex(x);if(c){var C=m.getData(c.sPath);if(C.Status==="U"){e.bEdit=true;e.iRequestTotalCount=e.iRequestTotalCount+1;var s=c.sPath.search("ConditionRecordUUID=guid'")+25;var r=c.sPath.substr(s,36);if(e.sRecordUUIDs===""){e.sRecordUUIDs=r;}else{e.sRecordUUIDs=e.sRecordUUIDs+","+r;}}else if(C.Status==="A"){this.sPopInfo="editinfomsg";}else if(C.Status==="B"){this.sPopInfo="editinfomsg";}if(C.ConditionRecord!==undefined){e.bIsGroup=false;}}else{break;}}return e;},_switchStatus:function(A){this._getDraftStatus();var s=this._oDraftStatus.getSelectedKey();switch(s){case"ownDraft":if(A==="Save"||A==="Cancel"){this._oDraftStatus.setSelectedKey("all");}break;case"unchanged":if(A==="Create"||A==="Edit"||A==="Copy"||A==="Save"||A==="Cancel"){this._oDraftStatus.setSelectedKey("all");}break;}},_checkGroup:function(){if(this._oTable.getGroupedColumns().length>0){this._addMsg(this._oResourceBundle.getText("actionNotAllowed"),M.Error);this._popMsg();return true;}else{return false;}},_checkBeforeSave:function(){var e=false;var m=this.oMessageManager.getMessageModel("message").getData();for(var i in m){if(m[i].controlIds.length>0){e=true;break;}}return e;},_onBeforeCreate:function(){var c={};c.ConditionSequentialNumber="01";var C=this._oSmartFilterBar.getFilterData().ConditionType;if(C!==undefined&&this._onGetFilterType(C)===false){var t=[];for(var x in this.aTypes){if(t.indexOf(this.aTypes[x].key)===-1){t.push(this.aTypes[x].key);}}if(t.length===1){c.ConditionType=t[0];}}var o=this._oSmartFilterBar.getFilterData().ConditionTable;if(o!==undefined&&this._onGetFilterTable(o)===false){var T=[];for(var y in this.aTables){if(T.indexOf(this.aTables[y].key)===-1){T.push(this.aTables[y].key);}}if(T.length===1){c.ConditionTable=T[0];}}if(this._oDynamicalAreaUtil){for(var i=0;i<this._oDynamicalAreaUtil.aFilterFields.length;i++){this._setDefaultVakey(c,this._oDynamicalAreaUtil.aFilterFields[i]);}}return c;},_onGetFilterType:function(c){var r=true;if(c.items.length===0&&c.ranges.length===0){return r;}else{r=false;this.aTypes.splice(0,this.aTypes.length);for(var x=0;x<c.items.length;x++){this.aTypes.push(c.items[x]);}for(var y=0;y<c.ranges.length;y++){if(c.ranges[y].exclude===false&&c.ranges[y].operation==="EQ"){this.aTypes.push({key:c.ranges[y].value1,text:""});}else{this.aTypes=[];r=true;break;}}return r;}},_onGetFilterTable:function(c){var r=true;if(c.items.length===0&&c.ranges.length===0){return r;}else{r=false;this.aTables.splice(0,this.aTables.length);for(var i=0;i<c.items.length;i++){this.aTables.push(c.items[i]);}for(var j=0;j<c.ranges.length;j++){if(c.ranges[j].exclude===false&&c.ranges[j].operation==="EQ"){this.aTables.push({key:c.ranges[j].value1,text:""});}else{this.aTables=[];r=true;break;}}return r;}},_onRemoveErrorMsg:function(e){var s=e.getSource().getParent().getParent();var m=this.oMessageManager.getMessageModel("message").getData();if(this.sRateValueField!==""){var t=s._sBindingContextPath+"/"+this.sRateValueField;this._removeErrorMsg(m,t);s.detachValidationSuccess(this._onRemoveErrorMsg,this);this.sRateValueField="";}},_removeErrorMsg:function(m,t){for(var i in m){if(m[i].target===t){this.oMessageManager.removeMessages(m[i]);}}},_removeErrorState:function(){var t=this._oSmartFilterBar.getControlByKey("ConditionType");var T=this._oSmartFilterBar.getControlByKey("ConditionTable");if(t.getValueState()==="Error"){t.setValue("");t.setValueState("None");t.setValueStateText("");}if(T.getValueState()==="Error"){T.setValue("");T.setValueState("None");T.setValueStateText("");}},_onPopMsg:function(e){var i=e.getSource().getParent().getParent().getAssociation("ariaLabelledBy").toString().search("ConditionRateValue");var I=e.getSource().getParent().getParent().getAssociation("ariaLabelledBy").toString().search("ConditionLowerLimit");var b=e.getSource().getParent().getParent().getAssociation("ariaLabelledBy").toString().search("ConditionUpperLimit");if(i!==-1||I!==-1||b!==-1){this.bRateValueError=true;}},_handleError:function(e){},_batchRequestForDownloadData:function(m){this._clearMsg();this._oDraftIndi.clearDraftState();m.submitChanges({groupId:"batchExportGroup",success:function(d,r){m.setHeaders({"DownloadExcel":""});this._oBusyModel.setProperty("/isBusy",false);if(r&&r.data&&r.data.__batchResponses[1]&&r.data.__batchResponses[1].data&&r.data.__batchResponses[1].data.ExcelName&&r.data.__batchResponses[1].data.ExcelName!=="#"){var e=r.data.__batchResponses[1].data.ExcelName;var b=atob(r.data.__batchResponses[1].data.ExcelContent);var c=new Array(b.length);for(var i=0;i<b.length;i++){c[i]=b.charCodeAt(i);}var g=new Uint8Array(c);var h=new Blob([g],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});if(sap.ui.Device.browser.msie){window.navigator.msSaveOrOpenBlob(h,e);}else{var t=window.document.createElement("a");var p=window.URL.createObjectURL(h);t.href=p;t.download=e;t.click();}}else{this._downloadErrorHandling(d);}}.bind(this),error:function(d,r){m.setHeaders({"DownloadExcel":""});this._processFail(d);}.bind(this)});},_fillDownloadDataSorter:function(s){var v=s._getTablePersonalisationData();if(v){var S=v.sorters;var b=sap.ui.model.odata.ODataUtils.createSortParams(S);var c=b;if(c){c=c.slice(9);}else{c="";}}else{c="";}return c;},_filterToString:function(o,m){var b=m.getMetaModel();var e=b.getODataEntityType("SD_PRICING_CONDITIONRECORD_SRV.C_SlsPricingConditionRecordTP");var c=m.getServiceMetadata();var s=sap.ui.model.odata.ODataUtils.createFilterParams(o,c,e);return s;},_fillDownloadTemplateFilter:function(o){var d=[];var b=[];var c=[];d.push(o[0]);while(d.length!==0){var n=d.pop();if(n.aFilters){for(var x=n.aFilters.length-1;x>=0;x--){d.push(n.aFilters[x]);}}else{if(n.sPath==="ConditionType"){if(n.oValue1){n.oValue1=n.oValue1.replace(/\'+/,"");n.oValue1=n.oValue1.replace(/\'+/,"");n.oValue1="''"+n.oValue1+"''";}c.push(n);}if(n.sPath==="ConditionTable"){if(n.oValue1){n.oValue1=n.oValue1.replace(/\'+/,"");n.oValue1=n.oValue1.replace(/\'+/,"");n.oValue1="''"+n.oValue1+"''";}b.push(n);}}}return{aFilterType:c,aFilterTable:b};},_parseDateFilter:function(p,b){var v=[];if(p.length!==0){var V=null;if(p[0].aFilters){for(var x in p[0].aFilters){if(p[0].aFilters[x].sPath!==undefined&&p[0].aFilters[x].sPath==="ValidOnDate"){V=p[0].aFilters[x];p[0].aFilters.splice(x,1);break;}}}else if(p[0].sPath==="ValidOnDate"){V=p[0];p.shift();}if(V){v.push(new F("ConditionValidityStartDate",a.LE,V.oValue1));v.push(new F("ConditionValidityEndDate",a.GE,V.oValue1));b.filters.push(new F({filters:v,and:true}));}}if(p.length!==0){this._processValidityDate(p,b,v);}},_processValidityDate:function(p,b,v){var s=null;var e=null;if(p[0].aFilters){for(var x in p[0].aFilters){if(p[0].aFilters[x].sPath!==undefined&&p[0].aFilters[x].sPath==="ConditionValidityStartDate"){s=p[0].aFilters[x];p[0].aFilters.splice(x,1);}}}else if(p[0].sPath==="ConditionValidityStartDate"){s=p[0];p.shift();}if(p[0].aFilters){for(x in p[0].aFilters){if(p[0].aFilters[x].sPath!==undefined&&p[0].aFilters[x].sPath==="ConditionValidityEndDate"){e=p[0].aFilters[x];p[0].aFilters.splice(x,1);if(p[0].aFilters.length===0){p.shift();}}}}else if(p[0].sPath==="ConditionValidityEndDate"){e=p[0];p.shift();}if(s||e){var c=[];if(v.length===0&&s){c.push(s);}if(v.length===0&&e){c.push(e);}if(c.length!==0){b.filters.push(new F({filters:c,and:true}));}}},_processNormalFilter:function(p,b,s){var A,c=null;for(var x in p[0].aFilters){if(p[0].aFilters[x].aFilters&&p[0].aFilters[x].aFilters[0].sPath===s){if(x==="0"&&p[0].aFilters.length>1&&p[0].aFilters[1].aFilters&&p[0].aFilters[1].aFilters[0].sPath===s){c=p[0].aFilters;A=p[0].bAnd;p.shift();}else{c=p[0].aFilters[x].aFilters;A=p[0].aFilters[x].bAnd;p[0].aFilters.splice(x,1);if(p[0].aFilters.length===0){p.shift();}}break;}else if(p[0].aFilters[x].aFilters&&p[0].aFilters[x].aFilters[0].aFilters&&p[0].aFilters[x].aFilters[0].aFilters[0].sPath===s){c=p[0].aFilters[x].aFilters;A=p[0].aFilters[x].bAnd;p[0].aFilters.splice(x,1);if(p[0].aFilters.length===0){p.shift();}}else if(p[0].aFilters[x].sPath&&p[0].aFilters[x].sPath===s){c=p[0].aFilters;A=p[0].bAnd;p.shift();break;}}if(c){b.filters.push(new F({filters:c,and:A}));}},_parseFilterMethod:function(p,b){if(this._oDynamicalAreaUtil&&this._oDynamicalAreaUtil.aKeyFieldsResult.length>0&&this.aTypes.length!==0){var k={};for(var x=0;x<this._oDynamicalAreaUtil.aKeyFieldsResult.length;x++){var o=this._oDynamicalAreaUtil.aKeyFieldsResult[x];if(o&&!k[o.ConditionType]){k[o.ConditionType]={};k[o.ConditionType][o.ConditionTable]=new Array(o.ConditionFieldName);}else if(o&&!k[o.ConditionType][o.ConditionTable]){k[o.ConditionType][o.ConditionTable]=new Array(o.ConditionFieldName);}else if(o&&k[o.ConditionType][o.ConditionTable].indexOf(o.ConditionFieldName)===-1){k[o.ConditionType][o.ConditionTable].push(o.ConditionFieldName);}}}if(k&&Object.getOwnPropertyNames(k).length!==0&&p.length!==0){var c=[];var K=[];for(x=0;x<p[0].aFilters.length;x++){var d=p[0].aFilters[x];if(d.aFilters&&d.aFilters[0].sPath!=="ConditionType"&&d.aFilters[0].sPath!=="ConditionTable"&&d.aFilters[0].sPath!=="ValidOnDate"&&d.aFilters[0].sPath!=="ConditionRecord"){for(var y=0;y<d.aFilters.length;y++){var A=[d.aFilters[y].sPath,d.aFilters[y].sOperator,d.aFilters[y].oValue1,d.aFilters[y].oValue2];K.push(A);}}}var s=Object.getOwnPropertyNames(k).toString();var e=K.toString();for(x=0;x<this.aTypes.length;x++){var g=[];g.push(new F("ConditionType",a.EQ,this.aTypes[x].key));if(s.indexOf(this.aTypes[x].key)!==-1){for(y=0;y<Object.getOwnPropertyNames(k[this.aTypes[x].key]).length;y++){var t=Object.getOwnPropertyNames(k[this.aTypes[x].key])[y];g.push(new F("ConditionTable",a.EQ,t));var h=k[this.aTypes[x].key][t];this._buildCombineFilter(h,e,K,g);c.push(new F({filters:g,and:true}));g=new Array(new F("ConditionType",a.EQ,this.aTypes[x].key));}g.push(new F("ConditionTable",a.EQ,""));c.push(new F({filters:g,and:true}));}}p.shift();b.filters.push(new F({filters:c,and:false}));}},_buildCombineFilter:function(k,K,b,c){for(var z in k){if(K.indexOf(k[z])!==-1){var d=[];for(var w in b){if(k[z]===b[w][0]){d.push(new F(b[w][0],b[w][1],b[w][2],b[w][3]));}}if(d.length!==0){c.push(new F({filters:d,and:false}));}}}},_rebuildFilter:function(b){if(this.aShowObj.length>0){var s={};s.aFilters=[];s.bAnd=true;s._bMultiFilter=true;var l=b.filters.length;for(var y=0;y<l;y++){var o=JSON.parse(JSON.stringify(b.filters[0]));s.aFilters.push(o);if(y!==l-1){b.filters.splice(0,1);}}var c=[];for(var x=0;x<this.aShowObj.length;x++){c.push(new F("ConditionRecord",a.EQ,this.aShowObj[x]));}var d={};d.aFilters=c;d.bAND=false;d.bMultiFilter=true;var C=[];C.push(s);C.push(d);b.filters[0].aFilters=C;b.filters[0].bAnd=false;}},_buildDynamicFilter:function(s,i,I,n){var c=this._oSmartFilterBar.getFilterData().ConditionType;var C=this._oSmartFilterBar.getFilterData().ConditionTable;var r=false;if(c!==undefined){if(this._onGetFilterType(c)){if(c.ranges.length!==0&&i!==-1){s.setValueState("Error");s.setValueStateText(n);}r=true;}if(C!==undefined){if(this._onGetFilterTable(C)){if(C.ranges.length!==0&&I!==-1){s.setValueState("Error");s.setValueStateText(n);}return;}if(r){return;}this._oBusyModel.setProperty("/isBusy",true);this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionType","values":this.aTypes},{"name":"ConditionTable","values":this.aTables}]);this._oDynamicalAreaUtil.changeDynamicalArea();this._removeErrorState();}else{if(r){return;}this.aTables.splice(0,this.aTables.length);this._oBusyModel.setProperty("/isBusy",true);this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionType","values":this.aTypes}]);this._oDynamicalAreaUtil.changeDynamicalArea();this._removeErrorState();}}else{this._processNoConditionType(s,C,I,n);}},_processNoConditionType:function(s,c,i,n){if(this.aTypes.length>0){this.aTypes.splice(0,this.aTypes.length);this.aTables.splice(0,this.aTables.length);this._oBusyModel.setProperty("/isBusy",true);this._oDynamicalAreaUtil.setFilterValues();this._oDynamicalAreaUtil.changeDynamicalArea();this._removeErrorState();}else{if(c!==undefined){if(this._onGetFilterTable(c)){if(c.ranges.length!==0&&i!==-1){s.setValueState("Error");s.setValueStateText(n);}return;}this._oBusyModel.setProperty("/isBusy",true);this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionTable","values":this.aTables}]);this._oDynamicalAreaUtil.changeDynamicalArea();this._removeErrorState();}else{this.aTables.splice(0,this.aTables.length);this._oBusyModel.setProperty("/isBusy",true);this._oDynamicalAreaUtil.setFilterValues();this._oDynamicalAreaUtil.changeDynamicalArea();this._removeErrorState();}}},_handleValueChange:function(e){var m=this.getModel();var s=e.getParameter("changeEvent").getSource();var b=s.getDataProperty().typePath;var t=s._sBindingContextPath+"/"+b;var u=e.getParameter("changeEvent").getParameter("unitChanged");var n=e.getParameter("changeEvent").getParameter("newValue");if(b==="Material"){this.bMaterialChange=true;return;}else if(b==="ConditionCalculationType"){this.bCalculationType=true;return;}else if(b==="ConditionQuantity"&&u){this.bQuantityUnitChange=true;return;}if((b==="ConditionToBaseQtyNmrtr"||b==="ConditionToBaseQtyDnmntr")&&(n.indexOf("-")===0||n===0||n==="0,000"||n==="00,000")){m.setProperty(t,s.getProperty("value"));return;}this._handleSpecificProperty(b,n,s);},_handleSpecificProperty:function(s,n,S){var m=this.getModel();var b=this.oMessageManager.getMessageModel("message").getData();if(s==="FixedValueDate"||s==="AdditionalValueDays"){var t;var v=(n===""||n==="0")?3:1;if(s==="FixedValueDate"){m.setProperty(S._sBindingContextPath+"/AdditionalValueDays_fc",v);t=S._sBindingContextPath+"/AdditionalValueDays";}else{m.setProperty(S._sBindingContextPath+"/FixedValueDate_fc",v);t=S._sBindingContextPath+"/FixedValueDate";}if(v===1){this._removeErrorMsg(b,t);}return;}if(s==="ConditionType"){var c=S._sBindingContextPath+"/ConditionTable";m.setProperty(c,"");c=S._sBindingContextPath+"/ConditionCalculationType";m.setProperty(c,"");}else if(s==="ConditionTable"){this._buildDynamicalColumn(S,n);}},_buildDynamicalColumn:function(s,n){var m=this.getModel();var b=s._sBindingContextPath+"/ConditionRecord";var r=m.getProperty(b);if(this.aShowObj.indexOf(r)===-1){this.aShowObj.push(r);}b=s._sBindingContextPath+"/ConditionType";var t=m.getProperty(b);if(n!==""&&t!==""&&t!==null){var T=[];var c=[];var d=[];var e=[];var i=this._oTable.getBinding().getLength();for(var y=0;y<i;y++){var C=this._oTable.getContextByIndex(y);if(C){var S=C.sPath.search("IsActiveEntity=")+15;var I=C.sPath.substr(S,4);if(I==="true"){break;}var p=C.sPath+"/ConditionType";var v=m.getProperty(p);if(v!==""&&e.indexOf(v)===-1){var o={key:v};d.push(o);e.push(v);}p=C.sPath+"/ConditionTable";var g=m.getProperty(p);if(g!==""&&c.indexOf(g)===-1){var h={key:g};T.push(h);c.push(g);}}else{break;}}this._clearMsg();if(d.length>0&&T.length>0){this._oBusyModel.setProperty("/isBusy",true);this.bTableChange=true;this._oDynamicalAreaUtil.setFilterValues([{"name":"ConditionType","values":d},{"name":"ConditionTable","values":T}]);}}},_buildCopyData:function(c){var m=this.getModel();var C=Object.assign({},m.getData(c.sPath));var n={};for(var z=0;z<this.aCopyFields.length;z++){if(C[this.aCopyFields[z]]!==undefined){n[this.aCopyFields[z]]=C[this.aCopyFields[z]];}}n.ConditionRecord="";n.ConditionSequentialNumber="01";n.ConditionQuantityUnit=C.ConditionQuantityUnit;n.ConditionRateValueUnit=C.ConditionRateValueUnit;m.create("/C_SlsPricingConditionRecordTP",n,{groupId:"batchCopyGroup"});},_prepareDeleteData:function(s){var r=0;var R="";var d;var b;var c=[];var m=this.getModel();this.sPopInfo="";for(var x=0;x<s.length;x++){var C=this._oTable.getContextByIndex(s[x]);if(C){var o=m.getData(C.sPath);this.iTotalEditableRecords++;if(o.Status==="D"){c.push(C.sPath);b=true;}else if(o.Status==="U"){d=true;r=r+1;var S=C.sPath.search("ConditionRecordUUID=guid'")+25;var u=C.sPath.substr(S,36);if(R===""){R=u;}else{R=R+","+u;}b=true;}else{this.sPopInfo="deleteinfomsg";}}else{break;}}for(var z=0;z<c.length;z++){m.remove(c[z],{groupId:"batchDeleteCondition"});}var e={};e.bDelete=d;e.bDeleteSend=b;e.sRecordUUIDs=R;e.iRequestTotalCount=r;return e;},_handleResopnseError:function(r){this._oBusyModel.setProperty("/isBusy",false);var t=[];var e=[];var m=JSON.parse(r);var b=m.error.innererror.errordetails;for(var w=0;w<b.length;w++){if(b[w].code==="/IWBEP/CX_MGW_BUSI_EXCEPTION"||b[w].code==="LCX_TECH_EXCEPTION"){continue;}var c=b[w].message.split(",");if(c[0]==="Take Over"){if(t.indexOf(c[1].substr(0,10))===-1){t.push(c[1].substr(0,10));}}else if(b[w].severity==="error"){if(e.indexOf(b[w].message)===-1){e.push(b[w].message);}}}if(e.length>0){for(w=0;w<e.length;w++){this._addMsg(e[w],M.Error,null,null,b[w].longtext_url);}this._popMsg();}else{this._draftExist(t);}},_prepareMessage:function(A,m,n,i,I,s){var o=JSON.parse(m);var b=o.message.split(",");if(b[0]==="No Authorization"){n.push({obj:b[1],text:A});if(A==="noEditAuthority"){this.aShowObj.push(b[1]);}}else{var S=o.message.split("SimulateWF:");if(s!==undefined&&S.length===2&&S[0]===""){s.push(S[1]);}else if(i.indexOf(o.message)===-1){i.push(o.message);I.push(o.severity);}if(A==="noSaveAuthority"&&o.code==="PRCG_CNDNRECORD_API/015"){var c=o.message.substr(17,10);this.aShowObj.push(c);}}for(var z=0;z<o.details.length;z++){b=o.details[z].message.split(",");if(b[0]==="No Authorization"){n.push({obj:b[1],text:A});if(A==="noEditAuthority"){this.aShowObj.push(b[1]);}}else{S=o.details[z].message.split("SimulateWF:");if(s!==undefined&&S.length===2&&S[0]===""){s.push(S[1]);}else if(i.indexOf(o.details[z].message)===-1){i.push(o.details[z].message);I.push(o.details[z].severity);}if(A==="noSaveAuthority"&&o.details[z].code==="PRCG_CNDNRECORD_API/015"){c=o.details[z].message.substr(17,10);this.aShowObj.push(c);}}}},_showMessage:function(n,I,b,s,m){if(n.length>0){for(var i=0;i<n.length;i++){var c=this._oResourceBundle.getText(n[i].text,[n[i].obj]);this._addMsg(c,M.Information);}}if(I.length>0){for(i=0;i<I.length;i++){this._addMsg(I[i],this._setMessageType(b[i]));}}if(this.sPopInfo!==""){this._addMsg(this._oResourceBundle.getText(this.sPopInfo),M.Information);}var d=this.oMessageManager.getMessageModel("message").getData();if(d.length>0){this._popMsg();}if(s&&this.iTotalEditableRecords!==n.length){if(m==="saveConditionFailText"){sap.m.MessageToast.show(this._oResourceBundle.getText("saveConditionText"));}else if(m==="deleteConditionFail"){sap.m.MessageToast.show(this._oResourceBundle.getText("conditionDeletedText"));}}},_setDefaultVakey:function(c,o){var b=this._oSmartFilterBar.getFilterData()[o];if(b!==undefined){var d=[];for(var x=0;x<b.items.length;x++){d.push(b.items[x]);}for(var y=0;y<b.ranges.length;y++){if(b.ranges[y].operation==="EQ"){d.push({key:b.ranges[y].value1,text:""});}else{d=[];break;}}var k=[];for(var z in d){if(k.indexOf(d[z].key)===-1){k.push(d[z].key);}}if(k.length===1){c[o]=k[0];}}},_downloadErrorHandling:function(d){for(var m=0;m<d.__batchResponses.length;m++){var r=d.__batchResponses[m].response;if(r!==undefined){var o=JSON.parse(r.body);var s=o.error.message.value;var e=[];e.push(s);var b=o.error.innererror.errordetails;for(var w=0;w<b.length;w++){if(e.indexOf(b[w].message)===-1){e.push(b[w].message);}}for(w=0;w<e.length;w++){this._addMsg(e[w],M.Error);}this._popMsg();}}},_parseTemplateFilterToString:function(b,c){var s;if(b.length){s=this._filterToString(b,this.getOwnerComponent().getModel());s=s.slice(8);}if(c.length){var d=this._filterToString(c,this.getOwnerComponent().getModel());if(s){s="("+s+")"+"%20and%20"+"("+d.slice(8)+")";}else{s=d.slice(8);}}if(!b.length&&!c.length){s="";}return s;},_createApproveDialog:function(b,c,A){var m=this.getModel();this.oApproveDialog=sap.ui.xmlfragment(this.getView().getId(),"zzcus.sd.salesprices.manage.view.Approve",this);this.oApproveDialog.setModel(m);this.getView().addDependent(this.oApproveDialog);this._oDescription=this.byId("descriptionInput");this._oReason=this.byId("reasonSFI");this._oApproveMessageStrip=this.byId("approveMessageStrip");this._oApproveMessageStrip.setVisible(false);if(b==="save"){this.byId("skip").setVisible(true);var s="mulSavedAR";}else{this.byId("cancelRequest").setVisible(true);s="mulSelectedAR";}if(A===true&&c>1){s=this._oResourceBundle.getText(s,c);this._oBusyModel.setProperty("/sApproveInfo",s);this._oApproveMessageStrip.setVisible(true);}else if(A===false&&c===1){this._oBusyModel.setProperty("/sApproveInfo",this._oResourceBundle.getText("mulSomeAR"));this._oApproveMessageStrip.setVisible(true);}else if(A===false&&c>1){s=this._oResourceBundle.getText("mulSomeMoreAR",c);this._oBusyModel.setProperty("/sApproveInfo",s);this._oApproveMessageStrip.setVisible(true);}m.setDeferredGroups(["doNotSubmit"]);this._oReason.setBindingContext(m.createEntry("/C_SlsPricingConditionRecordTP",{groupId:"doNotSubmit"}));this._oReason.bindProperty("value","ConditionChangeReason");this.oApproveDialog.open();this._oDescription.focus();},_closeApproveDialog:function(){this._oDescription.setValue("");this._oDescription.setValueState("None");this._oDescription.setValueStateText("");this.oApproveDialog.close();this.oApproveDialog.destroy();this.getModel().deleteCreatedEntry();},_handleFeature:function(){sap.s4h.cfnd.featuretoggle.lib.featuresAsync().then(function(b){if(b.getFeatureStatus("SD_PRICE_APPROVAL_BASIC_FUNCTION")===true){this.byId("requestApprove").setVisible(true);this.bApproveFeature=true;}else{this.byId("requestApprove").setVisible(false);this.bApproveFeature=false;}}.bind(this));},_buildAQData:function(){var A={bSend:false,iRequestTotalCount:0,sRecordUUIDs:"",bAll:true};var m=this.getModel();var s=[];if(this.sSelectAll==="true"){var t=this._oTable.getBinding().getLength();for(var y=0;y<t;y++){s.push(y);}}else{s=this._oPlugins.getSelectedIndices();}for(var x=0;x<s.length;x++){var c=this._oTable.getContextByIndex(s[x]);if(c){var C=m.getData(c.sPath);if(C.Status==="U"&&C.ConditionReleaseStatus==="A"){A.bSend=true;A.iRequestTotalCount=A.iRequestTotalCount+1;var S=c.sPath.search("ConditionRecordUUID=guid'")+25;var r=c.sPath.substr(S,36);if(A.sRecordUUIDs===""){A.sRecordUUIDs=r;}else{A.sRecordUUIDs=A.sRecordUUIDs+","+r;}}else{A.bAll=false;}}else{break;}}return A;},_triggerSaveWF:function(s){var r=[];var w=[];for(var i=0;i<s.length;i++){var S=s[i].split("/");if(S.length>1){if(r.indexOf(S[0])===-1){r.push(S[0]);}if(w.indexOf(S[1])===-1){w.push(S[1]);}}}if(w.length>0){this.aRequestConditions=r;this._createApproveDialog("save",w.length,true);}},_checkSelectedData:function(){var c={bSend:false,bCopy:false,bDelete:false};var m=this.getModel();var s=[];if(this.sSelectAll==="true"){var t=this._oTable.getBinding().getLength();for(var y=0;y<t;y++){s.push(y);}}else{s=this._oPlugins.getSelectedIndices();}for(var x=0;x<s.length;x++){var C=this._oTable.getContextByIndex(s[x]);if(C){var o=m.getData(C.sPath);if(o.Status==="U"){c.bCopy=true;if(o.ConditionReleaseStatus==="A"){c.bSend=true;}}if(o.ConditionReleaseStatus!=="D"&&o.ConditionReleaseStatus!=="F"){c.bDelete=true;}}else{break;}}return c;},_checkDeleteData:function(){var d=true;var m=this.getModel();var s=[];if(this.sSelectAll==="true"){var t=this._oTable.getBinding().getLength();for(var y=0;y<t;y++){s.push(y);}}else{s=this._oPlugins.getSelectedIndices();}for(var x=0;x<s.length;x++){var c=this._oTable.getContextByIndex(s[x]);if(c){var C=m.getData(c.sPath);if(C.ConditionReleaseStatus==="D"||C.ConditionReleaseStatus==="F"){d=false;break;}}else{break;}}return d;},_truncateRateValue:function(p,u,s){var b="/"+u+"/"+s;var m=p[s].split(".");var n=false;if(m[0].substr(0,1)==="-"){m[0]=m[0].substr(1);n=true;}if(m.length===1){var c=(m[0].length<11)?m[0].substr(0,9):m[0].substr(0,11);}else{c=m[0].substr(0,9)+"."+m[1];}if(n){c="-"+c;}this.getModel().setProperty(b,c);},_clearValueState:function(p){var m=this.oMessageManager.getMessageModel("message").getData();for(var j in m){if(m[j].aTargets[0]!==null){var P=m[j].aTargets[0].split("/");if(P[1]===p){this.oMessageManager.removeMessages(m[j]);}}}}});});
