/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/m/MessageToast","sap/ui/core/MessageType"],function(B,J,f,F,a,S,M,b){"use strict";return B.extend("zzcus.sd.salesprices.manage.controller.History",{formatter:f,sPath:"",constructor:function(){this._oBusyModel=null;this._oTable=null;this._oSmartFilterBar=null;this._oSmartTable=null;this._oFailedButton=null;this._oSuccessButton=null;},onInit:function(){this._oSmartFilterBar=this.byId("smartFilterBarHistory");this._oSmartTable=this.byId("lineItemsHistoryTable");this._oTable=this._oSmartTable.getTable();this._oFailedButton=this.byId("failedButton");this._oSuccessButton=this.byId("successedButton");this._oBusyModel=new J({isBusy:false});this.setModel(this._oBusyModel,"busy");this.getRouter().getRoute("history").attachPatternMatched(this._onObjectMatched,this);},onInitSmartFilterBar:function(e){this._oSmartFilterBar.search();},onInitSmartTable:function(e){this._oTable.bActiveHeaders=false;this._oSmartTable.applyVariant({sort:{sortItems:[{columnKey:"CndnRecdImportDateTime",operation:"Descending"}]}});this._oTable.setMode("SingleSelectLeft");},onSearch:function(e){if(this._oTable.getShowOverlay()){this._oTable.setShowOverlay(false);}},onFilterChange:function(e){if(!this._oTable.getShowOverlay()){this._oTable.setShowOverlay(true);}this._EnableButtons("0");},onAssignedFiltersChanged:function(e){var s=this.byId("historyStatusText");if(s&&this._oSmartFilterBar){var t=this._oSmartFilterBar.retrieveFiltersWithValuesAsText();s.setText(t);}},onDownloadFailed:function(e){var u=this.getModel().getData(this.sPath).ConditionRecordUUID;var d="/DownloadLogSet(UUID=guid'"+u+"',TYPE='E'"+")/$value";var U=this.getOwnerComponent().getModel().sServiceUrl+d;sap.m.URLHelper.redirect(U,false);},onDownloadSuccessed:function(e){var u=this.getModel().getData(this.sPath).ConditionRecordUUID;var d="/DownloadLogSet(UUID=guid'"+u+"',TYPE='S'"+")/$value";var U=this.getOwnerComponent().getModel().sServiceUrl+d;sap.m.URLHelper.redirect(U,false);},onIssueIconPressed:function(e){if(!this._oHintDialog){var v=this.getView();this._oHintDialog=sap.ui.xmlfragment(v.getId(),"zzcus.sd.salesprices.manage.view.IssuePopover",this);this._oHintDialog.setModel(v.getModel());v.addDependent(this._oHintDialog);this._oHintDialog.setResizable(false);}this._oHintDialog.openBy(e.getSource());},onSelectionChange:function(e){this.sPath=e.getParameter("listItem").getBindingContextPath();var c=this.getModel().getData(this.sPath);this._EnableButtons(c.CndnRecdImportStatus);},onUpdateFinished:function(e){var s=this._oTable.getSelectedItem();if(s!==undefined&&s!==null){var p=s.getBindingContextPath();var c=this.getModel().getData(p);this._EnableButtons(c.CndnRecdImportStatus);}else{this._EnableButtons("0");}},_onObjectMatched:function(e){if(this._oSmartFilterBar._bIsInitialized){this._oSmartFilterBar.search();}},_EnableButtons:function(s){switch(s){case"0":this._oFailedButton.setEnabled(false);this._oSuccessButton.setEnabled(false);break;case"1":this._oFailedButton.setEnabled(true);this._oSuccessButton.setEnabled(false);break;case"2":this._oFailedButton.setEnabled(true);this._oSuccessButton.setEnabled(true);break;case"3":this._oFailedButton.setEnabled(false);this._oSuccessButton.setEnabled(true);break;case"4":this._oFailedButton.setEnabled(false);this._oSuccessButton.setEnabled(false);break;}}});});
